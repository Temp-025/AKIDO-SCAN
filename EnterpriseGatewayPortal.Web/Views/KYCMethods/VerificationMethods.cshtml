@model EnterpriseGatewayPortal.Web.ViewModel.KYCMethods.KycMethodViewModel
@using EnterpriseGatewayPortal.Web.Models

@{
    ViewData["Title"] = "KYC Verification Methods";
    var status = Context.Request.Query["status"].ToString().ToLower() ?? "all";

    var hasData = Model != null;

    ViewBag.BreadCrumb = new List<BreadCrumbModel>
{
        new BreadCrumbModel { Title = "Verification Methods",Url = Url.Action("RequestVerificationMethod","KYCMethods") ,IconKey="QRML"},
    };

}

<style>
    :root {
        --primary: #92722A;
        --primary-light: #CBA344;
        --primary-bg: #fdf9f3;
        --text-primary: #2c3e50;
        --text-secondary: #7f8c8d;
        --border: #e1e5e9;
        --bg-surface: #ffffff;
        --shadow: 0 2px 6px rgba(0,0,0,0.05);
        --radius: 8px;
        --space-xs: 8px;
        --space-sm: 16px;
        --space-md: 24px;
        --space-lg: 32px;
    }

    .kyc-container {
        padding: var(--space-md);
        max-width: 1400px;
        margin: 0 auto;
    }

    .header-section {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--space-sm);
        margin-bottom: var(--space-md);
        flex-wrap: wrap;
    }

    /*    .header-text {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content:flex-start;
        gap: var(--space-xs);
    }*/

    .header-text > i {
        font-size: 40px;
    }

    .header-text h3 {
        font-size: 24px;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0 0 var(--space-xs) 0;
    }

    .header-text p {
        color: var(--text-secondary);
        margin: 0;
        font-size: 15px;
        line-height: 1.5;
        text-align: start;
    }

    .uaeid-primary {
        background: linear-gradient(90deg, var(--primary-light) 0%, var(--primary) 100%);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: var(--radius);
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: opacity 0.2s;
        box-shadow: var(--shadow);
    }

        .uaeid-primary:hover {
            opacity: 0.95;
            transform: translateY(-1px);
        }

    .table-filters {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        gap: var(--space-lg);
        margin-bottom: var(--space-sm);
        flex-wrap: wrap;
        align-items: end;
        /*border: 1px solid var(--border);
        padding: var(--space-sm);
        border-radius: var(--radius);
        box-shadow: var(--shadow);*/
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 250px;
    }

        .filter-group label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .filter-group input,
        .filter-group select {
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }

            .filter-group input:focus,
            .filter-group select:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(146, 114, 42, 0.2);
            }

    #searchInput {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%237f8c8d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.3-4.3'%3E%3C/path%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: 12px center;
        padding-left: 42px;
    }

    /*    .table-wrapper {
        background: var(--bg-surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: var(--shadow);
    }*/

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    thead th {
        background-color: #fafbfd;
        text-align: left;
        padding: 14px 20px;
        font-weight: 600;
        color: var(--text-primary);
        border-bottom: 1px solid var(--border);
    }

    tbody td {
        padding: 14px 20px;
        border-bottom: 1px solid var(--border);
        color: var(--text-secondary);
        vertical-align: top;
    }

    tbody tr:last-child td {
        border-bottom: none;
    }

    tbody tr:hover td {
        background-color: #fcfcfd;
    }

    .method-name {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 15px;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
    }

    .status-active {
        background: #e8f5e9;
        color: #2e7d32;
        border: 1px solid #c8e6c9;
    }

    .status-pending {
        background: #fff8e1;
        color: #f57f17;
        border: 1px solid #ffecb3;
    }

    .status-rejected {
        background: #ffebee;
        color: #c62828;
        border: 1px solid #ffcdd2;
    }

    .price {
        font-weight: 600;
        color: var(--text-primary);
    }

    .tags {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        margin-top: 6px;
    }

    .tag {
        background: var(--primary-bg);
        color: var(--primary);
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 999px;
        font-weight: 600;
    }

    .action-link {
        color: var(--primary);
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
    }

        .action-link:hover {
            text-decoration: underline;
        }

    @@media (max-width: 768px) {
        .header-section {
            flex-direction: column;
            align-items: stretch;
        }

        .table-filters {
            flex-direction: column;
            gap: var(--space-sm);
        }

        .filter-group {
            min-width: auto;
        }
    }

    #methods-table_wrapper {
        padding: 0px !important;
    }

    .col-sm-12 {
        padding: 0px !important;
    }
</style>

<div class="kyc-container">
    <!--<div class="header-section">-->
    @*<div class="header-text">
            <h3>Verification Methods</h3>
            <p>Manage Requested methods</p>
        </div>*@
    <!--<button class="uaeid-primary" type="button">
            <i class="ph ph-plus"></i> Add New Method
        </button>
    </div>-->

    <div class="table-filters">
        <div class="filter-group">
            @*<label for="searchInput">Search</label>*@
            <input type="text" id="searchInput" placeholder="Search by method name..." />
        </div>
        <div class="filter-group">
            @*<label for="statusFilter">Status</label>*@
            <select id="statusFilter">
                <option value="all" selected="@(status == "all")">All Statuses</option>
                <option value="approved" selected="@(status == "active")">Approved</option>
                <option value="pending" selected="@(status == "pending")">Pending</option>
                <option value="rejected" selected="@(status == "rejected")">Rejected</option>
            </select>
        </div>
    </div>

    <div class="table-wrapper">
        <table aria-label="KYC Verification Methods List" id="methods-table" class="table-striped table-bordered table-hover table-checkable order-column full-width table @(hasData ? "" : "empty-table")">
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Price</th>
                    <th>Categories</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var method in Model.Methods)
                {
                    <tr>
                        <td>
                            <div class="method-name">@method.MethodName</div>
                        </td>
                        <td>
                            <div class="price">@method.Pricing.ToString() AED</div>
                        </td>
                        <td>
                            <div class="tags">
                                @foreach (var category in method.TargetSegments)
                                {
                                    <div class="tag">@category</div>
                                }
                            </div>
                        </td>
                        <td>
                            <div class="status-badge @(method.RequestStatus.ToLower() == "approved" ? "status-active" : method.RequestStatus.ToLower() == "pending" ? "status-pending" : "status-rejected")">
                                @($"{char.ToUpper(method.RequestStatus[0])}{method.RequestStatus.Substring(1).ToLower()}")
                            </div>
                        </td>
                        <td>
                            <button class="btn btn-xs deepPink-bgcolor no-margin" type="button"
                                    data-toggle="dropdown" aria-expanded="false">
                                Actions <i class="fa fa-angle-down"></i>
                            </button>
                            <ul class="dropdown-menu pull-left" role="menu">
                                <li class="table-dropdown-li">
                                    <a asp-action="VerificationMethodStatus" asp-controller="KYCMethods" asp-route-methodUid="@method.MethodUid"
                                       onclick="document.getElementById('navigationNetworkOverlay').style.display='block'">
                                        <img src="~/assets/images/Eye_View_Icon.svg" alt="edit"
                                             style="position: relative;bottom: 1px;width: 18px;height: 18px;" />View Status
                                    </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    $(document).ready(function () {
        $("#networkOverlay").hide();

        const filterStatus = "@Model.filterStatus".toLowerCase() || "all";
        console.log("Filter Status from Model:", filterStatus);

        // Initialize DataTable
        const table = $("#methods-table").DataTable({
            "bLengthChange": false,
            "searching": false,
            "ordering": false,
            "paging": @hasData.ToString().ToLower(),
            "info": @hasData.ToString().ToLower(),
        });

        // Set dropdown based on the current filter status
        $('#statusFilter').val(filterStatus);

        // Filter rows immediately based on model status
        if (filterStatus !== "all") {
            table.rows().every(function () {
                const row = $(this.node());
                const statusText = row.find('.status-badge').text().trim().toLowerCase();
                if (statusText !== filterStatus) {
                    row.hide();
                } else {
                    row.show();
                }
            });
        }

        // When user changes filter manually
        $('#statusFilter').on('change', function () {
            const newStatus = $(this).val();
            const url = new URL(window.location);
            if (newStatus && newStatus !== 'all') {
                url.searchParams.set('status', newStatus);
            } else {
                url.searchParams.delete('status');
            }
            window.location.href = url.toString();
        });

        // Search input filter (client-side)
        $('#searchInput').on('input', function () {
            const term = this.value.toLowerCase();
            $('#methods-table tbody tr').each(function () {
                const method = $(this).find('td:eq(0)').text().toLowerCase();
                const price = $(this).find('td:eq(1)').text().toLowerCase();
                $(this).toggle(method.includes(term) || price.includes(term));
            });
        });
    });
</script>
