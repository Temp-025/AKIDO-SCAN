@model EnterpriseGatewayPortal.Web.Models.Clients.ClientsNewViewModel
@using EnterpriseGatewayPortal.Web.Models

@{
    ViewBag.Breadcrumb = new List<BreadCrumbModel>
    {
        new BreadCrumbModel { Title = "Business - Business Applications",Url = Url.Action("List","Clients"),IconKey = "business-applications"},
        new BreadCrumbModel {Title = "Create Application",Url="",IconKey = "add"}
    };
}

@{
    ViewData["Title"] = "Services New";
}

@{
    await Html.RenderPartialAsync("_AlertBox");
}
<style>
    /* ----------- Select dropdown css -------------*/

    .select2-container {
        width: 100% !important;
    }

        .select2-container .select2-selection--single {
            border-radius: 8px;
            align-items: center;
            box-sizing: border-box;
            justify-content: center;
            height: 40px !important;
            border: 1px solid #E2E8F0 !IMPORTANT;
            color: #3E4046 !important;
        }

    .selection {
        width: 100% !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        color: #3E4046 !important;
        font-size: 14px;
        font-family: inherit;
        padding: 5px 10px;
    }


    /* Remove default arrow */
    .select2-container--default .select2-selection--single .select2-selection__arrow b {
        border: none !important; /* removes default triangle */
    }

    /* Add your custom arrow */
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        background: url('@Url.Content("~/assets/images/dropDown-icon-brown.svg")');
        //background: url('@Url.Content("~/assets/images/imgDropDownBrown.png")');
        background-repeat: no-repeat;
        background-size: 16px 16px;
        width: 19px;
        top: 11px;
        vertical-align: middle;
        height: 100%;
    }

    .select2-search__field {
        display: none !important;
    }

    .select2-container .select2-dropdown.select2-dropdown--below {
        top: -5px !important;
    }

    .select2-container .select2-search.select2-search--dropdown {
        padding: 0 !important;
    }

    /*  .custom-check-box {
            margin-right: 5px;
            -webkit-print-color-adjust: exact;
            vertical-align: top;
            background-repeat: no-repeat;
            background-position: 50%;
            background-size: contain;
            position: relative !important;
            width: 1.125rem;
            height: 1.125rem;
            background-color: #fff;
            border: .125rem solid rgba(0,0,0,0.3);
        }
     */

    .popup {
        position: relative;
        display: inline-block;
        cursor: pointer;
        float: right;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .popuptext {
        visibility: hidden;
        min-width: 200px;
        background-color: #E6D7A2;
        color: #92722A;
        font-weight: 500;
        text-align: center;
        border-radius: 6px;   
        padding: 5px 5px;
        position: relative;
        z-index: 1111;
        right: 3%;
        margin-bottom: 35px;
        margin-top: -60px;
    }
    /* The actual popup */
    .popup .popuptext {
        visibility: hidden;
        min-width: 200px;
        background-color: #E6D7A2;
        color: #92722A;
        text-align: center;
        font-weight: 500;
        border-radius: 6px;
        padding: 5px 5px;
        position: relative;
        z-index: 1111;
        right: 3%;
        margin-bottom: 0px;
        margin-top: -60px;
    }

        /* Popup arrow */
        .popup .popuptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

    .popup:hover + .popuptext {
        visibility: visible;
        -webkit-animation: fadeIn 1s;
        animation: fadeIn 1s;
    }

    .custom-check-box:hover {
        outline: auto;
        outline-color: #5d9ceca3;
    }

    .classshide {
        display: none !important;
    }

    /*--------------------------------------------*/
    fieldset {
        border: 1px solid #E2E8F0 !IMPORTANT;
        border-radius: 8px;
        padding: 10px !important;
        border-radius: 5px;
        display: flex;
        flex-direction: column;
    }



    .custom-file-input-style {
        border: 1px solid #CBA344;
        border-radius: 4px;
        padding: 0 !important;
        padding-top: 6px !important;
        height: 40px;
        box-sizing: border-box;
        /* color: #C3C6CB; */
    }

        .custom-file-input-style::file-selector-button {
            border: none;
            background-color: transparent;
            font-weight: 400;
            padding: 6px 12px;
            margin: -6px 12px -6px 0; /* removes vertical spacing/gap */
            border-right: 1px solid #CBA344;
            cursor: pointer;
            height: calc(100% + 6px); /* ensure full height including padding */
            color: #6C4527;
        }

        .custom-file-input-style:hover::file-selector-button {
            background-color: rgba(249, 247, 237, 1); /* on hover */
        }

        /*  .form-control:focus {
                        border: 1px solid #92722A;
                        color: #1B1D21;
                    } */

        .custom-file-input-style:focus::file-selector-button {
            border-right: 1px solid #92722A; /* change to focus color */
        }

    /*-------- CheckBox css---------------------------- */
    .checkbox-primary {
        display: inline-flex !important;
        align-items: center; /* Align vertically center */
        gap: 16px; /* Item spacing = 16px */
        cursor: pointer;
        position: relative;
        color: #232528;
        margin-top: 0.5rem;
    }

    /* Checkbox itself */
    .custom-check-box {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 20px;
        height: 20px;
        border: 1px solid #CBA344;
        border-radius: 4px;
        background-color: #fff;
        cursor: pointer;
        position: relative;
        z-index: 2;
        transition: background-color 0.2s, border-color 0.2s;
    }

        /* Checkmark style */
        .custom-check-box:checked {
            background-color: #CBA344;
            border-color: #92722A;
        }

            .custom-check-box:checked::after {
                content: "✔";
                color: white;
                font-size: 14px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -55%);
            }

    /* Hover effect (circle background) */
    .checkbox-primary::before {
        content: "";
        position: absolute;
        left: -7px;
        top: -9px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: transparent;
        z-index: 1;
        transition: background-color 0.2s ease-in-out;
    }

    .checkbox-primary:hover::before {
        background-color: #F9F7ED;
    }

    .checkbox-primary input[type="checkbox"]:checked {
        background-color: #CBA344;
        border-color: #CBA344;
    }
    /*---------------------------------------------------------*/
    .file-upload-box {
        position: relative;
        border: 2px dashed #CBA344;
        border-radius: 8px;
        padding: 10px;
        text-align: center;
        margin: auto;
        color: #fff;
        overflow: hidden;
        cursor: pointer;
    }

    .upload-content {
        pointer-events: none;
    }

    .upload-text {
        font-size: 14px;
        color: #bbb;
    }

        .upload-text .highlight {
            font-weight: bold;
            color: #CBA344;
        }

        .upload-text small {
            display: block;
            margin-top: 5px;
            color: #888;
        }

    /* The invisible input covering the whole box */
    .file-input-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }


</style>

@{
    await Html.RenderPartialAsync("_AlertBox");
}
<div class="classshide">
    <div id='viewer'></div>
</div>
<label class="form-label sub-label">Add Business Application</label>
<div class="row" id="spacingCss">

    <div class="col-md-12 plr">
        <div class="card-custom">
            <div class="card-body">
                <form enctype="multipart/form-data" asp-action="Save">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <div class="form-group col-md-6" style="float:left;">
                                <div class="form-group">
                                    <label asp-for="ApplicationType" class="col-form-label s3"></label>
                              
                                    <select asp-for="ApplicationType" class="form-control select2"
                                            asp-items="Model.ApplcationTypeList">
                                    </select>
                             
                                    <span asp-validation-for="ApplicationType" class="text-danger"></span>
                                </div>
                                @*<div class="form-group">
                                    <label asp-for="OrganizationId" class="col-form-label s3"></label>
                                    <select asp-for="OrganizationId" class="form-control"
                                        asp-items="Model.OrganizatioList">
                                        <option value="">-- Select Organization --</option>
                                    </select>
                                    <span asp-validation-for="OrganizationId" class="text-danger"></span>
                                </div>*@
                                <div class="form-group">
                                    <label asp-for="ApplicationName" class="col-form-label s3"></label>
                                    <input asp-for="ApplicationName" class="form-control" />
                                    <span asp-validation-for="ApplicationName" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="ApplicationUri" class="col-form-label s3"></label>
                                    <input asp-for="ApplicationUri" class="form-control" />
                                    <span asp-validation-for="ApplicationUri" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="RedirectUri" class="col-form-label s3"></label>
                                    <input asp-for="RedirectUri" class="form-control" />
                                    <span asp-validation-for="RedirectUri" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="LogoutUri" class="col-form-label s3"></label>
                                    <input asp-for="LogoutUri" class="form-control" />
                                    <span asp-validation-for="LogoutUri" class="text-danger"></span>
                                </div>
                                <br />
                                @*<div class="form-group">
                                    <div class="checkbox">
                                    <label>
                                    <input asp-for="WithPkce" /> @Html.DisplayNameFor(model => model.WithPkce)
                                    </label>
                                    </div>
                                    </div>*@
                            </div>
                            <div class="form-group col-md-6" style="float:left;">
                                <div class="form-group" style="margin-bottom:-5px;">
                                    <label asp-for="ScopesList" class="col-form-label s3"></label>
                                    <fieldset>
                                        <div class="card-default" style="margin-left: 10px; margin-top:5px;">
                                            @foreach (var item in Model.ScopesList)
                                            {
                                                @*  <label>
                                                    <input type="checkbox" class="custom-check-box" name="ScopesList" value="@item" @(Model.Scopes.Contains(item) ? "checked" : "") />
                                                    @item
                                                </label> *@

                                                <label class="checkbox-primary" style="display: block;">
                                                    <input class="custom-check-box" type="checkbox" name="ScopesList" value="@item" @(Model.Scopes.Contains(item) ? "checked" : "") style="margin-left:5px" />
                                                    @item
                                                </label>

                                                <br>

                                            }
                                        </div>
                                    </fieldset>
                                    <span asp-validation-for="ScopesList" class="text-danger"></span>
                                </div>
                                <div class="form-group" style="margin-bottom:-5px;">
                                    <label asp-for="GrantTypesList" class="col-form-label s3"></label>
                                    <fieldset>
                                        <div class="card-default c-checkbox" style="margin-left: 10px; margin-top:5px;">
                                            @foreach (string item in Model.GrantTypesList)
                                            {
                                                @* <label>
                                                    <input type="checkbox" class="custom-check-box grantcheckbox" name="GrantTypesList" value="@item" @(Model.GrantTypes.Contains(item) ? "checked" : "") />
                                                    @item<span id="@item"></span>
                                                </label> *@

                                                <label class="checkbox-primary" style="display: block;">
                                                    <input class="custom-check-box" type="checkbox" name="GrantTypesList" value="@item" @(Model.GrantTypes.Contains(item) ? "checked" : "") style="margin-left:5px" />
                                                    @item<span id="@item"></span>
                                                </label>

                                                <br>

                                            }
                                        </div>
                                    </fieldset>
                                    <span asp-validation-for="GrantTypesList" class="text-danger"></span>
                                </div>
                                <div class="form-group" hidden>
                                    <input asp-for="GrantTypes" class="form-control" />
                                    <input asp-for="Scopes" class="form-control" />
                                </div>
                                <div class="form-group signing">

                                    @*  <label asp-for="Cert" class="col-form-label">Signing Certificate (.crt, .cer only) <span class="text-danger">*</span></label>
        <div class="popup"><i class="fa fa-info-circle"></i></div>
        <div class="popuptext">upload certificate for request signing purpose</div>
        <input asp-for="Cert" accept=".crt,.cer" class="form-control" />
        <span asp-validation-for="Cert" class="text-danger"></span> *@

                                    <label asp-for="Cert" class="col-form-label s3" style="display:inline-block; margin-bottom:0px;">Signing Certificate (.crt, .cer only) <span class="text-danger">*</span></label>
                                    <div class="popup"><i class="fa fa-info-circle"></i></div>
                                    <div class="popuptext">upload certificate for request signing purpose</div>
                                    <div class="file-upload-box">
                                        <div class="upload-content">
                                            <div class="upload-icon">
                                                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M26.7075 8.2925L21.7075 3.2925C21.6146 3.19967 21.5042 3.12605 21.3829 3.07586C21.2615 3.02568 21.1314 2.9999 21 3H11C10.4696 3 9.96086 3.21071 9.58579 3.58579C9.21071 3.96086 9 4.46957 9 5V7H7C6.46957 7 5.96086 7.21071 5.58579 7.58579C5.21071 7.96086 5 8.46957 5 9V27C5 27.5304 5.21071 28.0391 5.58579 28.4142C5.96086 28.7893 6.46957 29 7 29H21C21.5304 29 22.0391 28.7893 22.4142 28.4142C22.7893 28.0391 23 27.5304 23 27V25H25C25.5304 25 26.0391 24.7893 26.4142 24.4142C26.7893 24.0391 27 23.5304 27 23V9C27.0001 8.86864 26.9743 8.73855 26.9241 8.61715C26.8739 8.49576 26.8003 8.38544 26.7075 8.2925ZM21 27H7V9H16.5863L21 13.4137V23.98C21 23.9875 21 23.9937 21 24C21 24.0063 21 24.0125 21 24.02V27ZM25 23H23V13C23.0001 12.8686 22.9743 12.7385 22.9241 12.6172C22.8739 12.4958 22.8003 12.3854 22.7075 12.2925L17.7075 7.2925C17.6146 7.19967 17.5042 7.12605 17.3829 7.07586C17.2615 7.02568 17.1314 6.9999 17 7H11V5H20.5863L25 9.41375V23ZM18 19C18 19.2652 17.8946 19.5196 17.7071 19.7071C17.5196 19.8946 17.2652 20 17 20H11C10.7348 20 10.4804 19.8946 10.2929 19.7071C10.1054 19.5196 10 19.2652 10 19C10 18.7348 10.1054 18.4804 10.2929 18.2929C10.4804 18.1054 10.7348 18 11 18H17C17.2652 18 17.5196 18.1054 17.7071 18.2929C17.8946 18.4804 18 18.7348 18 19ZM18 23C18 23.2652 17.8946 23.5196 17.7071 23.7071C17.5196 23.8946 17.2652 24 17 24H11C10.7348 24 10.4804 23.8946 10.2929 23.7071C10.1054 23.5196 10 23.2652 10 23C10 22.7348 10.1054 22.4804 10.2929 22.2929C10.4804 22.1054 10.7348 22 11 22H17C17.2652 22 17.5196 22.1054 17.7071 22.2929C17.8946 22.4804 18 22.7348 18 23Z" fill="#343330" />
                                                </svg>
                                            </div>
                                            <div class="upload-text">
                                                <span id="certFileName" class="highlight">Choose a file</span><br />
                                                <small>.crt, .cer up to 20KB</small>
                                            </div>
                                        </div>
                                        <input asp-for="Cert" id="Cert" type="file" accept=".crt,.cer" class="file-input-overlay" />
                                    </div>


                                    <span asp-validation-for="Cert" class="text-danger"></span>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="padding-right: 10px">
                      
                            <div style="float: left;margin-top: 11px;padding-left: 22px;">
                                <b>NOTE: </b>(*) Mark fields are mandatory.
                            </div>
                        <div class="d-flex justify-content-end">
                            <a asp-action="List" class="btn btn-other">
                                Cancel
                            </a>
                            &nbsp;&nbsp;                         

                            <button class="btn btn-primary uaeid-primary" type="submit">
                                Save
                            </button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function () {
                 document.getElementById("navigationNetworkOverlay").style.display = "none";

            $("#BusinessModule > a")
                .attr("aria-expanded", "true")
                .addClass("active");

            $("#BusinessModule")
                .addClass("submenu-active show");

            $("#BusinessModule .submenu")
                .addClass("show");

            $('#Business-Applications').addClass('active');

                if ($('#sidebar ul li.dropdown.active')) {
                    $('#sidebar ul li.dropdown.active ul').addClass('show');
                    $('#eSeal').addClass('active');
                    $('#sidebar ul li.dropdown.active a.nav-link.drop-logo').attr('aria-expanded', 'true');
                }

                /*For Beadcrum Start*/
                $('#homeMenu').addClass('breadcrumb-item').append('Applications > New');
                $('#mainMenu').removeClass('breadcrumb-item');
                $('#subMenu').removeClass('breadcrumb-item');
                $('#networkOverlay').hide();
                $('.select2').select2();

            document.getElementById("ApplicationType").addEventListener("change", setcheckbox)

            $("input[name=GrantTypesList]").on("change", (e) => {
                var list1 = document.getElementById("GrantTypes").value;
                var list = (list1) ? list1.split(" ") : [];
                if (e.target.checked) {

                    if (!list.includes(e.target.value)) {
                        list.push(e.target.value)
                        list = list.join(" ");
                        document.getElementById("GrantTypes").value = list;
                    }
                }
                else {
                    if (list.includes(e.target.value)) {
                        var i = list.indexOf(e.target.value)
                        list.splice(i, 1);
                        list = list.join(" ");
                        document.getElementById("GrantTypes").value = list;
                    }
                }
            });

            $("input[name=ScopesList]").on("change", (e) => {
                var list1 = document.getElementById("Scopes").value;
                var list = (list1) ? list1.split(" ") : [];
                if (e.target.checked) {

                    if (!list.includes(e.target.value)) {
                        list.push(e.target.value)
                        list = list.join(" ");
                        document.getElementById("Scopes").value = list;
                    }
                }
                else {
                    if (list.includes(e.target.value)) {
                        var i = list.indexOf(e.target.value)
                        list.splice(i, 1);
                        list = list.join(" ");
                        document.getElementById("Scopes").value = list;
                    }
                }

            });

            setcheckbox();

            const parentNavItem = document.querySelector(`[data-section="Business"] .nav-link`);
            if (parentNavItem) {
                parentNavItem.classList.add("active");
            }

            document.getElementById("Cert").addEventListener("change", function () {
                const fileInput = this;
                const fileNameLabel = document.getElementById("certFileName");

                if (fileInput.files.length > 0) {
                    fileNameLabel.textContent = fileInput.files[0].name;
                } else {
                    fileNameLabel.textContent = "Choose a file";
                }
            });

        });



        function setcheckbox() {
            var AppType = document.getElementById("ApplicationType").value;
            var grantTypecheckboxes = Array.from(document.querySelectorAll('input[name="GrantTypesList"]'));
            var Scopecheckboxes = Array.from(document.querySelectorAll('input[name="ScopesList"]'));

            $('input[name="GrantTypesList"]').each(function (index) {
                document.getElementById(this.value).innerHTML = "";
                this.checked = false;
            });

            var openidScope = Scopecheckboxes.find(function (e) {
                return e.value == "openid";
            });
            var ProfileScope = Scopecheckboxes.find(function (e) {
                return e.value == "urn:idp:digitalid:profile";
            });

            if (AppType == "Regular Web Application") {
                var authorization_code = grantTypecheckboxes.find(function (e) {
                    return e.value == "authorization_code";
                });
                authorization_code.checked = true;
                document.getElementById("authorization_code").innerHTML = "<b>( Recommended )</b>";

            }
            if (AppType == "Native" || AppType == "Single Page Application") {

                var authorization_code_with_pkce = grantTypecheckboxes.find(function (e) {
                    return e.value == "authorization_code_with_pkce";
                });
                authorization_code_with_pkce.checked = true;
                document.getElementById("authorization_code_with_pkce").innerHTML = "<b>( Recommended )</b>";

            }
            if (AppType == "Machine to Machine Application") {

                var client_credentials = grantTypecheckboxes.find(function (e) {
                    return e.value == "client_credentials";
                });
                client_credentials.checked = true;
                document.getElementById("client_credentials").innerHTML = "<b>( Recommended )</b>";

            }
            openidScope.checked = true;
            ProfileScope.checked = true;

            document.getElementById("GrantTypes").value = $("input[name='GrantTypesList']:checked").val()
            document.getElementById("Scopes").value = openidScope.value + " " + ProfileScope.value
        }
    </script>
}