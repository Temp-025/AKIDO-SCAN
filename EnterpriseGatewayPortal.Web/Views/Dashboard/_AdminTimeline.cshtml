@model IEnumerable<EnterpriseGatewayPortal.Core.Domain.Models.AdminLog>

@inject IHttpContextAccessor httpContextAccessor

@{
    var theme = "Uaeid";
}


<style>
    /* UAE ID Design System Colors */
    :root {
        --uaeid-primary: #B8860B;
        --uaeid-primary-light: #D4AF37;
        --uaeid-secondary: #8B4513;
        --uaeid-success: #22C55E;
        --uaeid-info: #3B82F6;
        --uaeid-warning: #F59E0B;
        --uaeid-danger: #EF4444;
        --uaeid-dark: #1F2937;
        --uaeid-light: #F8FAFC;
        --uaeid-gray-50: #F9FAFB;
        --uaeid-gray-100: #F3F4F6;
        --uaeid-gray-200: #E5E7EB;
        --uaeid-gray-300: #D1D5DB;
        --uaeid-gray-400: #9CA3AF;
        --uaeid-gray-500: #6B7280;
        --uaeid-gray-600: #4B5563;
        --uaeid-gray-700: #374151;
        --uaeid-gray-800: #1F2937;
        --uaeid-gray-900: #111827;
    }

    #project-timeline-container-u {
        padding: 24px;
        height: 436px;
        border-radius: 12px;
        position: relative;
        margin-bottom: 16px;
        overflow-y: auto;
        font-family: 'Inter', Tahoma, Geneva, Verdana, sans-serif;
    }

    #project-timeline-container::-webkit-scrollbar {
        width: 6px;
    }

    #project-timeline-container::-webkit-scrollbar-track {
        background: var(--uaeid-gray-100);
        border-radius: 3px;
    }

    #project-timeline-container::-webkit-scrollbar-thumb {
        background: var(--uaeid-primary);
        border-radius: 3px;
    }

        #project-timeline-container::-webkit-scrollbar-thumb:hover {
            background: var(--uaeid-primary-light);
        }

    .timeline-container {
        position: relative;
        padding-left: 20px;
    }

        .timeline-container::before {
            content: '';
            position: absolute;
            left: 4px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #92722A;
            border-radius: 1px;
        }

    .timeline-item-u {
        margin-bottom: 20px;
        position: relative;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
    }

        /*        .timeline-item-u:hover {
            transform: translateX(4px);
        }*/

        .timeline-item-u::before {
            content: '';
            position: absolute;
            left: -21px;
            top: 26px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--uaeid-primary);
            border: 2px solid #ffffff;
            z-index: 2;
        }

    .timeline-content-u {
        height: 100%; /* Fill parent */
        display: flex;
        flex-direction: column;
        box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
        justify-content: space-between;
        padding: 10px 16px 0px 16px;
        border-radius: 12px;
        margin-left: 10px;
        background: #F9F7ED;
        overflow: hidden; /* Prevents spilling */
        box-sizing: border-box;
    }

        /*        .timeline-content-u:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            border-color: var(--uaeid-primary);
        }*/

        .timeline-content-u::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 16px;
            width: 18px;
            height: 0;
            border-top: 16px solid transparent;
            border-bottom: 16px solid transparent;
            border-right: 15px solid #ffffff;
            filter: drop-shadow(-1px 0 1px rgba(0, 0, 0, 0.05));
        }

        .timeline-content-u::before {
            border-right-color: #F9F7ED;
        }

    .timeline-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 7px;
        padding-bottom: 8px;
    }

    .timeline-date {
        font-weight: 600;
        font-size: 14px;
        color: var(--uaeid-gray-800);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .timeline-time {
        font-size: 12px;
        color: var(--uaeid-gray-500);
        padding: 4px 10px;
        border-radius: 20px;
        /*        border: 1px solid var(--uaeid-gray-200);*/
        font-weight: 500;
    }

    .timeline-user {
        margin-bottom: 8px;
        font-size: 13px;
        color: var(--uaeid-gray-600);
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 8px;
    }

    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--uaeid-primary) 0%, var(--uaeid-primary-light) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 16px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .timeline-message {
        color: var(--uaeid-gray-700);
        font-size: 14px;
        line-height: 1.5;
        margin: 0;
        word-wrap: break-word;
        border-bottom: 1px solid var(--uaeid-gray-300);
        padding-bottom: 12px;
    }

    /* Status indicators based on content */
    .timeline-item-info .timeline-item::before {
        background: var(--uaeid-info);
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    .timeline-item-success .timeline-item::before {
        background: var(--uaeid-success);
        box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
    }

    .timeline-item-warning .timeline-item::before {
        background: var(--uaeid-warning);
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }

    .timeline-item-danger .timeline-item::before {
        background: var(--uaeid-danger);
        box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }

    /* Empty state */
    .timeline-empty {
        text-align: center;
        padding: 48px 24px;
        color: var(--uaeid-gray-400);
    }

    .timeline-empty-icon {
        font-size: 48px;
        margin-bottom: 16px;
        color: var(--uaeid-gray-300);
    }

    /* Responsive design */

    @@media (max-width: 768px) {
        #project-timeline-container {
            padding: 16px;
            height: 400px;
        }

        .timeline-container {
            padding-left: 24px;
        }

        .timeline-content {
            padding: 16px 18px;
        }

        .timeline-header {
            flex-direction: row;
            align-items: flex-start;
            gap: 8px;
        }
    }

    /* Animation for new items */
    @@keyframes slideInFromLeft {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .timeline-item {
        animation: slideInFromLeft 0.5s ease-out;
    }
</style>


@*Common*@
<style>
    #project-timeline-container {
        color: #4b5356;
        height: 421px;
        position: relative;
        margin-bottom: 12px;
        overflow-y: auto;
    }

    .timeline-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 20px;
    }

    .timeline-item-color-1 {
        background-color: #ECFBF9;
    }

    .timeline-item-color-2 {
        background-color: #FDECEC;
    }

    .timeline-item-color-3 {
        background-color: #EDEDFC;
    }

    .timeline-item-color-4 {
        background-color: #FCFAEB;
    }

    /* .timeline-badge {
        background-color: #007bff;
        border-radius: 50%;
        padding: 10px;
        margin-right: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
    } */

    /* .timeline-badge i {
            color: #fff;
        } */

    .timeline-content {
        padding: 7px 15px 7px 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-height: 150px;
        overflow: auto;
        border: 1px solid #000;
    }

        .timeline-content h6 {
            margin-bottom: 10px;
            color: #000 !important;
        }
</style>

@if (theme == "Uaeid")
{
    <div id="project-timeline-container-u">
        <div class="timeline-container">
            @if (Model != null && Model.Any())
            {
                foreach (var log in Model)
                {
                    string date;
                    string time;
                    string userInitials;
                    DateTime timeStamp;

                    if (log.Timestamp.HasValue)
                    {
                        var utcTime = DateTime.SpecifyKind(log.Timestamp.Value, DateTimeKind.Utc);
                        timeStamp = utcTime.ToLocalTime();
                    }
                    else
                    {
                        timeStamp = DateTime.Now;
                    }

                    if (timeStamp.Date == DateTime.Now.Date)
                    {
                        date = "Today";
                        time = timeStamp.ToString("hh:mm tt");
                    }
                    else if (timeStamp.Date == DateTime.Today.AddDays(-1).Date)
                    {
                        date = "Yesterday";
                        time = timeStamp.ToString("hh:mm tt");
                    }
                    else
                    {
                        date = timeStamp.ToString("dd MMM yyyy");
                        time = timeStamp.ToString("hh:mm tt");
                    }

                    // Get user initials for avatar
                    userInitials = string.IsNullOrEmpty(log.Username) ? "?" :
                        string.Join("", log.Username.Split(' ').Take(2).Select(n => n.FirstOrDefault())).ToUpper();
                    if (string.IsNullOrEmpty(userInitials)) userInitials = "?";

                    <div class="timeline-item-u">
                        <div class="timeline-content-u">

                            <div class="timeline-user">
                                <div class="user-avatar">
                                    @userInitials
                                </div>
                                <div style="display:flex;flex-direction:column;">
                                    <strong>@log.Username</strong>
                                    @if (!string.IsNullOrEmpty(log.Identifieremail))
                                    {
                                        <span style="color: var(--uaeid-gray-500)">(@log.Identifieremail)</span>
                                    }
                                </div>
                            </div>

                            <div class="timeline-message">
                                @log.Logmessage
                            </div>

                            <div class="timeline-header">
                                <div class="timeline-date">
                                    <i class="fas fa-calendar-alt" style="color: var(--uaeid-primary); font-size: 12px;"></i>
                                    <span class="ts-date" data-utc="@log.Timestamp?.ToString("O")">--</span>
                                </div>
                                <div class="timeline-time">
                                    <span class="ts-time" data-utc="@log.Timestamp?.ToString("O")">--</span>
                                </div>
                            </div>

                        </div>
                    </div>
                }
            }
            else
            {
                <div class="timeline-empty">
                    <div class="timeline-empty-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h6 style="color: var(--uaeid-gray-500); margin-bottom: 8px;">No Activity Yet</h6>
                    <p style="color: var(--uaeid-gray-400); margin: 0; font-size: 14px;">Activity logs will appear here when available.</p>
                </div>
            }
        </div>
    </div>
}

else
{
    <div id="project-timeline-container" class="ps">
        <div class="card-body uaeid-timeline-card pt-5">
            <div>

                @if (Model != null)
                {
                    var colorClasses = new[] { "timeline-item-color-1", "timeline-item-color-2", "timeline-item-color-3", "timeline-item-color-4" };

                    var i = 0;

                    foreach (var log in Model)
                    {
                        string date;
                        string time;
                        {
                            var timeStamp = Convert.ToDateTime(log.Timestamp);
                            if (timeStamp.Date == DateTime.Today.Date)
                            {
                                date = "Today";
                                time = timeStamp.ToString("hh:mm tt");
                            }
                            else if (timeStamp.Date == DateTime.Today.AddDays(-1).Date)
                            {
                                date = "Yesterday";
                                time = timeStamp.ToString("hh:mm tt");
                            }
                            else
                            {
                                date = timeStamp.ToString("dd-MM-yyyy");
                                time = timeStamp.ToString("hh:mm tt");
                            }
                        }
                        var color = colorClasses[i];
                        <div class="timeline-item">
                            @* <div class="timeline-badge">
                                    <i class="fa fa-clock fs-1 text-white"></i>
                                </div> *@
                            <div class="timeline-content @color">
                                <h6>
                                    <span>@date</span>
                                    <span style="float:right;">@time</span>
                                </h6>
                                <div class="text-gray-500">@log.Username (@log.Identifieremail)</div>
                                <div class="text-muted" style="color:#000 !important">@log.Logmessage</div>
                            </div>
                        </div>
                        i++;

                        if (i >= 4) i = 0;
                    }
                }

            </div>
        </div>
    </div>

}

<script>
        const dateEls = document.querySelectorAll(".ts-date");
        const timeEls = document.querySelectorAll(".ts-time");

        function formatForUser(utc) {
            const d = new Date(utc); // browser converts UTC -> user's local time
            if (isNaN(d.getTime())) return { dateText: "-", timeText: "-" };

            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const dDay = new Date(d.getFullYear(), d.getMonth(), d.getDate());

            const diffDays = Math.round((dDay - today) / (24 * 60 * 60 * 1000));

            let dateText;
            if (diffDays === 0) {
                dateText = "Today";
            } else if (diffDays === -1) {
                dateText = "Yesterday";
            } else {
                // e.g., 18 Feb 2026
                dateText = d.toLocaleDateString(undefined, { day: "2-digit", month: "short", year: "numeric" });
            }

            // e.g., 03:30 PM
            const timeText = d.toLocaleTimeString(undefined, { hour: "2-digit", minute: "2-digit", hour12: true });

            return { dateText, timeText };
        }

        dateEls.forEach((el, idx) => {
            const utc = el.dataset.utc;
            const tEl = timeEls[idx];
            if (!utc) { el.textContent = "-"; if (tEl) tEl.textContent = "-"; return; }

            const { dateText, timeText } = formatForUser(utc);
            el.textContent = dateText;
            if (tEl) tEl.textContent = timeText;
        });
</script>
