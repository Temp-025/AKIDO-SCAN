@using EnterpriseGatewayPortal.Core.DTOs;
@using Newtonsoft.Json;
@using EnterpriseGatewayPortal.Web.Models
@model EnterpriseGatewayPortal.Web.ViewModel.Beneficiaries.BeneficiariesEditViewModel
@{
    ViewBag.Breadcrumb = new List<BreadCrumbModel>
    {
        new BreadCrumbModel { Title = "Business - Beneficiaries",Url = Url.Action("BeneficiaryList","Beneficiaries"),IconKey = "beneficiaries"},
        new BreadCrumbModel { Title = "Edit Beneficiary",Url = "",IconKey = "edit"},
    };
}
@{
    ViewData["Title"] = "Add";
}
@{
    await Html.RenderPartialAsync("_AlertBox");
}
@{
    var Id = ViewBag.Id;
}
@{
    var layoutType = Context.Request.Cookies["HeaderNavigationLayout"];
}
<style>

    /*-------- CheckBox css---------------------------- */
    .checkbox-primary {
        display: inline-flex !important;
        align-items: center; /* Align vertically center */
        gap: 16px; /* Item spacing = 16px */
        cursor: pointer;
        position: relative;
        color: #232528;
        margin-top: 0.5rem;
    }

    /* Checkbox itself */
    .custom-check-box {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 20px;
        height: 20px;
        border: 1px solid #CBA344;
        border-radius: 4px;
        background-color: #fff;
        cursor: pointer;
        position: relative;
        z-index: 2;
        transition: background-color 0.2s, border-color 0.2s;
    }

        /* Checkmark style */
        .custom-check-box:checked {
            background-color: #CBA344;
            border-color: #92722A;
        }

            .custom-check-box:checked::after {
                content: "✔";
                color: white;
                font-size: 14px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -55%);
            }

    /* Hover effect (circle background) */
    .checkbox-primary::before {
        content: "";
        position: absolute;
        left: -7px;
        top: -9px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: transparent;
        z-index: 1;
        transition: background-color 0.2s ease-in-out;
    }

    .checkbox-primary:hover::before {
        background-color: #F9F7ED;
    }

    .checkbox-primary input[type="checkbox"]:checked {
        background-color: #CBA344;
        border-color: #CBA344;
    }
    /*---------------------------------------------------------*/

    .Validity-Date {
        display: inline-flex !important;
        align-items: center;
        gap: 16px;
        cursor: pointer;
        position: relative;
        color: #232528;
        margin-top: 0.5rem;
    }




    #ServicesA {
        list-style-type: none;
        padding: 0;
    }

    fieldset {
        border: 1px solid #E2E8F0 !IMPORTANT;
        border-radius: 8px;
        padding: 10px !important;
        border-radius: 5px;
        display: flex;
        flex-direction: column;
    }

    .classshide {
        display: none !important;
    }

    /* ------- mobileNumber css ------------------------- */
    .styled-input-group {
        display: flex;
        align-items: center;
        border: 1px solid #E2E8F0 !IMPORTANT;
        border-radius: 8px;
        padding: 6px 10px;
        background-color: #fff;
        height: 40px;
    }

    .country-code-dropdown {
        appearance: none;
        border: none;
        margin-left: -4px;
        background: transparent;
        color: #CBA344;
        font-weight: 500;
        font-size: 14px;
        padding-right: 34px;
        margin-right: 0;
        position: relative;
        z-index: 2;
        background-image: url('@Url.Content("~/assets/images/imgDropDownBrown.png")');
        background-repeat: no-repeat;
        background-size: 18px 18px; /* ↓ decreased size */
        background-position: right 8px center; /* keeps it aligned nicely */
    }

        .country-code-dropdown:focus {
            outline: none;
        }

    .mobile-input {
        border: none;
        flex: 1;
        font-size: 16px;
        color: #3E4046 !important;
        padding: 4px 0;
        background-color: transparent;
    }

        .mobile-input::placeholder {
            color: #999;
        }

        .mobile-input:focus {
            outline: none;
        }

    .country-code-dropdown::-ms-expand {
        display: none;
    }

    .country-code-dropdown::after {
        content: "\F282";
        position: absolute;
        right: 10px;
        width: 12px;
        height: 12px;
        background-image: url('@Url.Content("~/assets/images/imgDropDownBrown.png")');
        background-size: 12px 12px;
        background-repeat: no-repeat;
        background-size: contain;
        pointer-events: none;
    }

    .country-code-dropdown::before {
        margin-left: 3px;
    }

    option {
        color: rgba(0, 0, 0, 0.87);
    }

    .c-radio span {
        width: 24px !important;
        height: 24px !important;
        bottom: 2px !important;
    }

    .c-radio input[type=radio]:checked + span {
        border-color: #92722A !important;
        width: 24px;
        height: 24px;
        bottom: 2px;
    }

        .c-checkbox input[type=radio]:checked + span:before, .c-radio input[type=radio]:checked + span:before {
            color: #92722A !important;
            padding: 2px;
        }

    .c-radio:hover span {
        border-color: #92722A !important;
    }

    /* ----------- Select dropdown css -------------*/

    .select2-container {
        width: 100% !important;
    }

        .select2-container .select2-selection--single {
            border-radius: 8px;
            align-items: center;
            box-sizing: border-box;
            justify-content: center;
            height: 40px !important;
            border: 1px solid #E2E8F0 !IMPORTANT;
            color: #3E4046 !important;
        }

    .selection {
        width: 100% !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        color: #3E4046 !important;
        font-size: 14px;
        font-family: inherit;
        padding: 5px 10px;
    }


    /* Remove default arrow */
    .select2-container--default .select2-selection--single .select2-selection__arrow b {
        border: none !important; /* removes default triangle */
    }

    /* Add your custom arrow */
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        // background: url('@Url.Content("~/assets/images/dropDown-icon-brown.svg")'); /*previously used*/
        //background: url('@Url.Content("~/assets/images/imgDropDownBrown.png")');
        background: url("data:image/svg+xml,%3Csvg width='32' height='32' viewBox='0 0 32 32' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M27.0613 13.0612L17.0613 23.0612C16.9219 23.2011 16.7563 23.312 16.574 23.3877C16.3917 23.4634 16.1962 23.5024 15.9988 23.5024C15.8013 23.5024 15.6059 23.4634 15.4235 23.3877C15.2412 23.312 15.0756 23.2011 14.9363 23.0612L4.93626 13.0612C4.65446 12.7794 4.49615 12.3972 4.49615 11.9987C4.49615 11.6002 4.65446 11.218 4.93626 10.9362C5.21805 10.6544 5.60024 10.4961 5.99876 10.4961C6.39727 10.4961 6.77946 10.6544 7.06126 10.9362L16 19.875L24.9388 10.935C25.2205 10.6532 25.6027 10.4949 26.0013 10.4949C26.3998 10.4949 26.782 10.6532 27.0638 10.935C27.3455 11.2168 27.5039 11.599 27.5039 11.9975C27.5039 12.396 27.3455 12.7782 27.0638 13.06L27.0613 13.0612Z' fill='%2392722A'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-size: 16px 16px;
        width: 19px;
        top: 11px;
        vertical-align: middle;
        height: 100%;
    }

    .select2-search__field {
        display: none !important;
    }

    // .select2-search select2-search--dropdown {
        // display: none !important;
        //
    }

    .select2-container .select2-dropdown.select2-dropdown--below {
        top: -5px !important;
        border-radius: 8px !important;
        border: 1px solid #C3C6CB;
        box-shadow: 0px 1px 2px 0px #0000001A;
    }

    .select2-container .select2-search.select2-search--dropdown {
        padding: 0 !important;
    }


    /*---------------------------------------------------------------------*/


    .select2-results__options {
        border-radius: 8px !important;
    }

    /* ----------- Select dropdown css -------------*/

    /* Selection box */
    .country-code-dropdown + .select2-container--default .select2-selection--single {
        border: none;
        border-radius: 8px;
        display: flex;
        align-items: center;
        padding: 6px 10px;
        position: relative;
        padding-left: 0px;
        top: 0px;
        font-size: 14px;
        font-weight: 500;
        height: 28px !important;
        box-shadow: none !important;
        color: #92722A !important;
        border: none !important;
    }

    #countryCode + .select2-container {
        width: unset !important;
    }

    /* Rendered text */
    .country-code-dropdown + .select2-container--default .select2-selection--single .select2-selection__rendered {
        color: #92722A !important;
        padding-left: 0;
        padding-right: 34px;
        font-size: 14px;
        line-height: 1.4;
    }

    /* Remove default arrow */
    .country-code-dropdown + .select2-container--default .select2-selection--single .select2-selection__arrow b {
        border: none !important;
    }

    /* Custom arrow */
    .country-code-dropdown + .select2-container--default .select2-selection--single .select2-selection__arrow {
        // background: url('@Url.Content("~/assets/images/imgDropDownBrown.png")') no-repeat center; /*previously used*/

        background: url("data:image/svg+xml,%3Csvg width='32' height='32' viewBox='0 0 32 32' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M27.0613 13.0612L17.0613 23.0612C16.9219 23.2011 16.7563 23.312 16.574 23.3877C16.3917 23.4634 16.1962 23.5024 15.9988 23.5024C15.8013 23.5024 15.6059 23.4634 15.4235 23.3877C15.2412 23.312 15.0756 23.2011 14.9363 23.0612L4.93626 13.0612C4.65446 12.7794 4.49615 12.3972 4.49615 11.9987C4.49615 11.6002 4.65446 11.218 4.93626 10.9362C5.21805 10.6544 5.60024 10.4961 5.99876 10.4961C6.39727 10.4961 6.77946 10.6544 7.06126 10.9362L16 19.875L24.9388 10.935C25.2205 10.6532 25.6027 10.4949 26.0013 10.4949C26.3998 10.4949 26.782 10.6532 27.0638 10.935C27.3455 11.2168 27.5039 11.599 27.5039 11.9975C27.5039 12.396 27.3455 12.7782 27.0638 13.06L27.0613 13.0612Z' fill='%2392722A'/%3E%3C/svg%3E");
        background-size: 18px 18px;
        width: 18px;
        height: 18px;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
    }

    /* Hide search box inside dropdown */
    .country-code-dropdown + .select2-container .select2-search__field {
        display: none !important;
    }

    /* Dropdown menu */
    .country-code-dropdown + .select2-container .select2-dropdown {
        border-radius: 8px !important;
        border: 1px solid #C3C6CB;
        box-shadow: 0px 1px 2px 0px #0000001A;
    }

    #countryCode + .select2-container .select2-results {
        border-radius: 8px !important;
        border: 1px solid #C3C6CB;
        box-shadow: 0px 1px 2px 0px #0000001A;
    }



    #select2-countryCode-results {
        border-radius: 8px !important;
    }

</style>
<div class="classshide">
    <div id='viewer'></div>
</div>
<label class="form-label sub-label">Edit Beneficiary</label>
<div class="row" id="spacingCss">
    <div class="col-md-12 plr">
        <div class="card-custom">
            <div class="card-body">
                <form asp-action="UpdateBeneficiariesUser" asp-controller="Beneficiaries" id="beneficiariesUserForm" enctype="multipart/form-data">
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <div class="form-group col-md-6" style="float:left;">
                               @* <div class="form-group">
                                    <label asp-for="BeneficiaryOfficeEmail" class="col-form-label">Beneficiary Office Email</label>
                                    @{
                                        var employeeEmail = Model.BeneficiaryOfficeEmail;
                                    }
                                    <input asp-for="BeneficiaryOfficeEmail" class="form-control" tabindex="1" value="@employeeEmail" />
                                    <span asp-validation-for="BeneficiaryOfficeEmail" class="text-danger"></span>
                                </div>*@
                                <div class="form-group">
                                    <label asp-for="BeneficiaryUgpassEmail" class="col-form-label">Beneficiary Email</label>
                                    @{
                                        var ugpassEmail = Model.BeneficiaryUgpassEmail;
                                    }
                                    <input asp-for="BeneficiaryUgpassEmail" class="form-control" tabindex="1" value="@ugpassEmail" />
                                    <span asp-validation-for="BeneficiaryUgpassEmail" class="text-danger"></span>
                                </div>

 
                                <div class="form-group">
                                    <label asp-for="BeneficiaryNin" class="col-form-label">National Id Number</label>
                                    @{
                                        var nationalIdNumber = Model.BeneficiaryNin;
                                    }
                                    <input asp-for="BeneficiaryNin" class="form-control" tabindex="1" value="@nationalIdNumber" />
                                    <span asp-validation-for="BeneficiaryNin" class="text-danger"></span>
                                </div>

                               @*  <div class="form-group">
                                    <label asp-for="BeneficiaryMobileNumber" class="col-form-label">Mobile Number</label>
                                    @{
                                        var mobileNumber = Model.BeneficiaryMobileNumber;
                                    }
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <select asp-for="countryCode" class="custom-select" style="height: 34px;">
                                                <option value="+256">+256</option>
                                                <option value="+91">+91</option>
                                            </select>
                                        </div>
                                        <input asp-for="BeneficiaryMobileNumber" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" class="form-control" tabindex="2" />
                                    </div>
                                    <span asp-validation-for="BeneficiaryMobileNumber" class="text-danger"></span>
                                </div> *@

                                <div class="form-group">
                                    <label asp-for="BeneficiaryMobileNumber" class="col-form-label">Mobile number</label>
                                    @{
                                        var mobileNumber = Model.BeneficiaryMobileNumber;
                                    }
                                    <div class="styled-input-group">
                                        <select id="countryCode" class="country-code-dropdown select2">
                                            <option value="+971">&nbsp;&nbsp;+971</option>
                                            <option value="+91">&nbsp;&nbsp;+91</option>
                                            <option value="+256">&nbsp;&nbsp;+256</option>
                                        </select>
                                        <input asp-for="BeneficiaryMobileNumber" class="mobile-input"
                                               oninput="this.value = this.value.replace(/[^0-9]/g, '')" tabindex="2" />
                                    </div>
                                    <span asp-validation-for="BeneficiaryMobileNumber" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="BeneficiaryPassport" class="col-form-label">Passport Number</label>
                                    @{
                                        var passportNumber = Model.BeneficiaryPassport;
                                    }
                                    <input asp-for="BeneficiaryPassport" class="form-control" tabindex="1" value="@passportNumber" />
                                    <span asp-validation-for="BeneficiaryPassport" class="text-danger"></span>
                                </div>

                               @* <div class="form-group">
                                    <label asp-for="Designation" class="col-form-label"></label>
                                    @{
                                        var designation = Model.Designation;
                                    }
                                    <input asp-for="Designation" class="form-control" tabindex="1" value="@designation" />
                                    <span asp-validation-for="Designation" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="SignaturePhoto" class="col-form-label">Signature Photo</label>
                                    @{
                                        var signaturePhoto = Model.SignaturePhoto;
                                    }
                                    <input type="file" asp-for="SignaturePhoto" class="form-control" onchange="FileToBase64(this)" tabindex="1" accept=".jpg, .png, .jpeg" value="@signaturePhoto" />
                                    <input type="hidden" asp-for="SignaturePhoto" id="BusinessUser_Signature" />

                                </div>*@
                                

                               @* <div class="form-group">
                                    <label asp-for="SponsorType" class="col-form-label">Sponsor Type</label>
                                    <select class="form-control" asp-for="SponsorType" name="sponsor" style="padding: 5px;">
                                        <option value="Choose Option">Choose Option</option>
                                        <option value="Organization" selected="@(Model.SponsorType == "Organization")">Organization</option>
                                        <option value="Individual" selected="@(Model.SponsorType == "Individual")">Individual</option>

                                    </select>
                                </div>
                                </br>
                                <div class="form-group">
                                    <label asp-for="BeneficiaryType" class="col-form-label">Beneficiary Type</label>
                                    <select class="form-control" asp-for="BeneficiaryType" name="beneficiary" style="padding: 5px;">
                                        <option value="Choose Option">Choose Option</option>
                                        <option value="Organization" selected="@(Model.BeneficiaryType == "Organization")">Organization</option>
                                        <option value="Individual" selected="@(Model.BeneficiaryType == "Individual")">Individual</option>

                                    </select>
                                </div>*@


                            </div>

                            @* Previlages*@
                     
                         <div class="form-group col-md-6" style="float:left;">
                            <div class="form-group">
                              <label class="col-form-label" style="display: inline-block;">Services</label>&nbsp;<span style="color: red;">*</span>
                              <fieldset>

                                <ul id="ServicesA" style="list-style: none; padding: 0;">
                                    @for (int i = 0; i < Model.BeneficiariedPrivilegeList.Count; i++)
                                    {
                                        <li style="margin-bottom:10px;">
                                            @{
                                                var serviceCheckbox = "Previlages_" + i + "__service";
                                                var validityCheckbox = "Previlages_" + i + "__validity";
                                                var validityFromInput = "Previlages_" + i + "__validityFrom";
                                                var validityUptoInput = "Previlages_" + i + "__validityUpto";
                                                var validityDiv = "validity_" + i + "_div";

                                                var servicePrivilege = Model.BeneficiaryValidities.FirstOrDefault(sp => sp.PrivilegeServiceId == Model.BeneficiariedPrivilegeList[i].privilegeId /*&& sp.Valid_From != null*/);
                                                bool isValidityApplicable = servicePrivilege.ValidityApplicable;
                                            }

                                            <div class="form-check" style="margin-bottom: 10px;">
                                               @*  <input class="form-check-input" type="checkbox" id="@serviceCheckbox" name="selectedPrivileges" value="@Model.BeneficiariedPrivilegeList[i].privilegeId" @(servicePrivilege.PrivilegeChecked != false ? "checked" : "") onclick="toggleValidity(@i)" style="margin-right: 10px;">
                                                <label class="form-check-label" for="@serviceCheckbox">@Model.BeneficiariedPrivilegeList[i].privilegeServiceDisplayName</label> *@

                                               <label class="checkbox-primary" for="@serviceCheckbox" style="display: block;">
                                                   <input class="custom-check-box" type="checkbox" id="@serviceCheckbox" name="selectedPrivileges" value="@Model.BeneficiariedPrivilegeList[i].privilegeId" @(servicePrivilege.PrivilegeChecked != false ? "checked" : "") onclick="toggleValidity(@i)" style="margin-left:5px" />
                                                   @Model.BeneficiariedPrivilegeList[i].privilegeServiceDisplayName
                                               </label>
                                            
                                            
                                            </div>

                                              @if (servicePrivilege.PrivilegeChecked == true)
                                                {
                                                 <div class="validity-checkbox" id="@validityDiv" style="margin-left: 30px;">
                                                   @*  <input class="form-check-input validity-checkboxInput" type="checkbox" id="@validityCheckbox" name="selectedValidity" value="@Model.BeneficiariedPrivilegeList[i].privilegeId" @(servicePrivilege.ValidityApplicable == true ? "checked" : "") onclick="toggleValidity_input(@i)">
                                                    <label class="form-check-label" for="@validityCheckbox">Validity</label> *@

                                                    <label class="checkbox-primary" for="@validityCheckbox" style="display: block;">
                                                       <input class="custom-check-box" type="checkbox" id="@validityCheckbox" name="selectedValidity" value="@Model.BeneficiariedPrivilegeList[i].privilegeId" @(servicePrivilege.ValidityApplicable == true ? "checked" : "") onclick="toggleValidity_input(@i)" />
                                                        Validity
                                                    </label>

                                                 </div>
                                              }
                                            else
                                            {
                                            <div class="validity-checkbox" id="@validityDiv" style="@(isValidityApplicable ? "" : "display:none;"); margin-left: 30px;">
                                               @*  <input class="form-check-input validity-checkboxInput" type="checkbox" id="@validityCheckbox" name="selectedValidity" value="@Model.BeneficiariedPrivilegeList[i].privilegeId" @(servicePrivilege.ValidityApplicable != false ? "checked" : "") onclick="toggleValidity_input(@i)">
                                                <label class="form-check-label" for="@validityCheckbox">Validity</label> *@

                                                <label class="checkbox-primary" for="@validityCheckbox" style="display: block;">
                                                    <input class="custom-check-box" type="checkbox" id="@validityCheckbox" name="selectedValidity" value="@Model.BeneficiariedPrivilegeList[i].privilegeId" @(servicePrivilege.ValidityApplicable != false ? "checked" : "") onclick="toggleValidity_input(@i)"  />
                                                    Validity
                                                </label>

                                            </div>

                                            }
                                          <div class="row" style="margin-left:42px !important;">
                                            <div class="validity-input1" style="@(isValidityApplicable ? "" : "display:none;"); margin-left:20px;">
                                                <label class="Validity-Date" for="@validityFromInput" style="width:150px;">Validity From:</label>
                                                <input type="date" class="form-control date-pick" style="width: 200px;" id="@validityFromInput" name="validityFrom[@i]" value="@((servicePrivilege.validFrom != null && servicePrivilege.validFrom.HasValue) ? servicePrivilege.validFrom.Value.ToString("yyyy-MM-dd") : "")">
                                            </div>
                                                <div class="form-group validity-input2" style="@(isValidityApplicable ? "" : "display:none;"); margin-left:20px;">
                                                <label class="Validity-Date" for="@validityUptoInput" style="width:150px;">Validity Upto:</label>
                                                <input type="date" class="form-control date-pick" style="width: 200px;" id="@validityUptoInput" name="validityUpto[@i]" value="@((servicePrivilege.validUpTo != null && servicePrivilege.validUpTo.HasValue) ? servicePrivilege.validUpTo.Value.ToString("yyyy-MM-dd") : "")">
                                            </div>
                                          </div>

                                        </li>
                                    }

                                </ul>
 
                              </fieldset>

                            </div>
                          </div>
                        </div>
                    </div>
                    <div style="padding-right: 10px">
                        <div style="float: left;margin-top: 37px;padding-left: 22px;">
                            <b>NOTE: </b>(*) Mark fields are mandatory.
                        </div>
                        <div class="d-flex justify-content-end" style="padding-top: 31px;">
                            <a type="button" asp-action="BeneficiaryList" class="btn btn-other">
                                Cancel
                            </a>
                            &nbsp;&nbsp;
                        
                            <button type="button" id="submitBtn" class="btn btn-primary uaeid-primary" onclick="UpdateBeneficiariesUser()">Update</button>

                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>

    var checkbox;
    var selectedValues = [];
    var ninRegex = /^[A-Z0-9]{1,14}$/;
    var passportRegex = /^[A-Z0-9]{1,12}$/;

    $(document).ready(function () {
        document.getElementById("navigationNetworkOverlay").style.display = "none";
        $('#countryCode').select2();
       var layoutType = '@(layoutType ?? "")';
        if (layoutType == "Vertical") {

            $("#BusinessModule > a")
                .attr("aria-expanded", "true")
                .addClass("active");

            $("#BusinessModule")
                .addClass("submenu-active show");

            $("#BusinessModule .submenu")
                .addClass("show");

            $('#Beneficiaries').addClass('active');

            if ($('#sidebar ul li.dropdown.active')) {
                $('#sidebar ul li.dropdown.active ul').addClass('show');
                $('#eSeal').addClass('active');
                $('#sidebar ul li.dropdown.active a.nav-link.drop-logo').attr('aria-expanded', 'true');
            }

            /*For Beadcrum Start*/
            $('#homeMenu').addClass('breadcrumb-item').append('Beneficiaries > Edit');
            $('#mainMenu').removeClass('breadcrumb-item');
            $('#subMenu').removeClass('breadcrumb-item');
            }
        $('#networkOverlay').hide();
        var CountryCode = $("#countryCode").val();
        var mobileNum = '@Model.BeneficiaryMobileNumber';
        var extractedNumber = "0";
        var countryCodeLength = 0;
        if (CountryCode) {
            if (CountryCode == "+91") {
                $("#countryCode").val("+91");
            } else {
                $("#countryCode").val("+256");
            }
        }

        setMinDate();

        const parentNavItem = document.querySelector(`[data-section="Business"] .nav-link`);
        if (parentNavItem) {
            parentNavItem.classList.add("active");
        }

    });

    function setMinDate() {
        var dtToday = new Date();

        var month = dtToday.getMonth() + 1;
        var day = dtToday.getDate();
        var year = dtToday.getFullYear();

        if (month < 10)
            month = '0' + month.toString();
        if (day < 10)
            day = '0' + day.toString();

        var maxDate = year + '-' + month + '-' + day;
        $('.date-pick').each(function () {
            $(this).attr('min', maxDate);
        });
    }

    function toggleValidity(index) {

        var isChecked = $("#Previlages_" + index + "__service").is(":checked");
        var validityCheckbox = $(".validity-checkbox").eq(index);
        var validityCheckboxInput = $(".validity-checkboxInput").eq(index);
        var validityInput1 = $(".validity-input1").eq(index);
        var validityInput2 = $(".validity-input2").eq(index);

        $(".validity-checkbox").eq(index).show();
        if (isChecked == false) {

            $("#Previlages_" + index + "__validity").prop("checked", false);
            $(".validity-checkbox").eq(index).hide();
            validityInput1.hide().val("");
            validityInput2.hide().val("");
        }

    }

    function toggleValidity_input(index) {

        var validityInput1 = $(".validity-input1").eq(index);
        var validityInput2 = $(".validity-input2").eq(index);
        var isChecked = $("#Previlages_" + index + "__validity").is(":checked");

        $("#Previlages_" + index + "__validityFrom").val("");
        $("#Previlages_" + index + "__validityUpto").val("")
        $(".validity-input1").eq(index).toggle(isChecked);
        $(".validity-input2").eq(index).toggle(isChecked);

    }

    function FileToBase64(element) {

        var file = element.files[0];

        var maxSizeKB = 20;
        var maxSize = maxSizeKB * 1024;
        if (file.size > maxSize) {
            return Swal.fire({ icon: 'error', title: "Max size exceeded", text: "File must be less than 20 Kb" });
        }

        var reader = new FileReader();

        reader.onloadend = function () {
            var base64String = reader.result.split(',')[1]; // Extract base64 string from data URL
            $("#BusinessUser_Signature").val(base64String);
        }

        reader.readAsDataURL(file);
    }

    function UpdateBeneficiariesUser() {
        var validData = true;
        var isValid = true;
        var dateValid = true;
        $('input[name="selectedPrivileges"]:checked').each(function () {

            var index = $(this).attr('id').split('_')[1];
            var privilegeId = $(this).val();
            var validityCheckbox = $('#Previlages_' + index + '__validity').prop('checked');
            var validityFrom = $('#Previlages_' + index + '__validityFrom').val();
            if (validityFrom == "") {
                validityFrom = null;
            }
            var validityUpto = $('#Previlages_' + index + '__validityUpto').val();
            if (validityUpto == "") {
                validityUpto = null;
            }
            if (validityCheckbox) {
                if (validityFrom == null || validityUpto == null) {
                    isValid = false;
                }
                else if (validityFrom > validityUpto) {
                    isValid = false;
                    dateValid = false;
                }
            }
            var selectedObject = {
                privilegeId: privilegeId,
                validityCheckbox: validityCheckbox,
                validityFrom: validityFrom,
                validityUpto: validityUpto
            };
            selectedValues.push(selectedObject);
        });


        if (!isValid) {
            if (dateValid === false) {
                Swal.fire({
                    icon: 'info',
                    title: 'Add Beneficiary',
                    text: 'ValidityTo should be less than ValidityFrom',
                    showCancelButton: false,
                    confirmButtonText: 'OK'
                }).then((result) => {
                    if (result.isConfirmed) {
                    }
                });
                selectedValues = [];
                return;
            } else {
                Swal.fire({
                    icon: 'info',
                    title: 'Add Beneficiary',
                    text: 'Enter validity dates',
                    showCancelButton: false,
                    confirmButtonText: 'OK'
                }).then((result) => {
                    if (result.isConfirmed) {
                    }
                });
                selectedValues = [];
                return;
            }
        }
   


        var form = $("#beneficiariesUserForm");
        var url = form.attr("action");
        var validData = true;

        var ugpassEmail = $('#BeneficiaryUgpassEmail').val();
        var nationalIdNumber = $('#BeneficiaryNin').val();
        var passportNumber = $('#BeneficiaryPassport').val();
        //var employeeEmail = $('#BeneficiaryOfficeEmail').val();
       // var signaturePhoto = $('#BusinessUser_Signature').val();
        var mobileNumber = $('#BeneficiaryMobileNumber').val();
      //  var designation = $('#Designation').val();
        var isSelected = false;

        //var sponsorType = document.getElementById('SponsorType').value;
        //if (sponsorType != "Choose Option") {
        //    var sponsor = document.getElementById('SponsorType').value;
        //}
        //else {
        //    var sponsor = null;
        //}

        //var beneficiaryType = document.getElementById('BeneficiaryType').value;
        //if (beneficiaryType != "Choose Option") {
        //    var beneficiar = document.getElementById('BeneficiaryType').value;
        //}
        //else {
        //    var beneficiar = null;
        //}

        //if (employeeEmail == null || employeeEmail.trim() === '') {
        //    $('#BeneficiaryOfficeEmail').siblings(".text-danger").text("Employee Email is required.");
        //    validData = false;
        //} else if (!isValidEmail(employeeEmail)) {
        //    $('#BeneficiaryOfficeEmail').siblings(".text-danger").text("Please enter a valid employee email address.");
        //    validData = false;
        //} else {
        //    $('#BeneficiaryOfficeEmail').siblings(".text-danger").text(""); // Clear the validation message if no error
        //}

        // Validate the UgpassEmail field
        if (ugpassEmail && !isValidEmail(ugpassEmail)) {
            $('#BeneficiaryUgpassEmail').siblings(".text-danger").text("Please enter a valid UAEID email address.");
            validData = false;
        } else {
            $('#BeneficiaryUgpassEmail').siblings(".text-danger").text(""); // Clear the validation message if no error
            isSelected = true;
        }

        if (nationalIdNumber && !ninRegex.test(nationalIdNumber)) {
            $('#BeneficiaryNin').siblings(".text-danger").text("Please enter a valid NIN number accepts A-Z(capital)&0-9 and max length is 14.");
            validData = false;

        }
        else {
            $('#BeneficiaryNin').siblings(".text-danger").text("");
            isSelected = true;
        }

        if (passportNumber && !passportRegex.test(passportNumber)) {
            $('#BeneficiaryPassport').siblings(".text-danger").text("Please enter a valid passport number accepts A-Z(capital)&0-12 and max length is 12.");
            validData = false;

        }
        else {
            $('#BeneficiaryPassport').siblings(".text-danger").text("");
            isSelected = true;
        }


        // Validate Mobile Number if it is filled
        if (mobileNumber) {
            var mobilevalid = ValidateNumber(mobileNumber);
            if (mobilevalid == false) {
                var selectedCode = $('#countryCode').val();
                var mobileerrormessage = "";
                if (selectedCode == "+256") {
                    Swal.fire({
                        icon: 'info',
                        title: "Add Beneficiary",
                        text: "Mobile number should be 9 digits",
                        showCancelButton: false,
                        closeOnConfirm: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                        }
                    });
                }
                else {
                    Swal.fire({
                        icon: 'info',
                        title: "Add Beneficiary",
                        text: "Mobile number should be 10 digits",
                        showCancelButton: false,
                        closeOnConfirm: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                        }
                    });
                }
                 selectedValues = [];
                return;
            }

        }

        if (mobileNumber == "" && passportNumber == "" && nationalIdNumber == "" && ugpassEmail == "") {
            Swal.fire({
                icon: 'info',
                title: "Add Beneficiary",
                text: 'Please enter UAEID Email/ Mobile Number/ Passport Number/ Nin',
                showCancelButton: false,
                closeOnConfirm: true
            }).then((result) => {
                if (result.isConfirmed) {
                }
            });
             selectedValues = [];
            return;
        }
        if (!validData) {
             selectedValues = [];
            return;
        }
        if (isSelected == false) {
            Swal.fire({
                icon: 'info',
                title: "Add Beneficiary",
                text: "Please enter UAEID Email/ Mobile Number/ Passport Number/ Nin",
                showCancelButton: false,
                closeOnConfirm: true
            }).then((result) => {
                if (result.isConfirmed) {
                }
            });
             selectedValues = [];
            return;
        }
        var mobilenumber = "";
        if ($('#MobileNumber').val() != "") {
            mobilenumber = $('#countryCode').val() + $('#BeneficiaryMobileNumber').val();
        }

        if (!selectedValues || selectedValues.length === 0) {
            Swal.fire({
                icon: 'info',
                title: "Add Beneficiary",
                text: 'please select atleast one Service',
                showCancelButton: false,
                closeOnConfirm: true
            }).then((result) => {
                if (result.isConfirmed) {
                }
            });
            return;
        }

        var beneficiariesUser = {
            Id : @ViewBag.Id,
            //sponsorDigitalId: $('#sponsorDigitalId').val(),
            //sponsorName: $('#sponsorName').val(),
          //  SponsorType: sponsor,
            //SponsorExternalId: null,
            //BeneficiaryDigitalId: null,
          //  BeneficiaryType: beneficiar,
            NationalIdNumber: $('#BeneficiaryNin').val(),
            PassportNumber: $('#BeneficiaryPassport').val(),
            MobileNumber: mobilenumber,
          //  EmployeeEmail: $('#BeneficiaryOfficeEmail').val(),
            UgpassEmail: $('#BeneficiaryUgpassEmail').val(),
           // SignaturePhoto: signaturePhoto,
           // Designation: $('#Designation').val(),
            BeneficiaryEditValidities: selectedValues,
        };

        $.ajax({
            type: "POST",
            url: url,
            data: JSON.stringify(beneficiariesUser),
            contentType: "application/json",
            beforeSend: function () {
                $('#overlay').show();
            },
            complete: function () {

                $('#overlay').hide();
            },
            success: function (data) {
                if (data.status == true) {
                    Swal.fire({
                        icon: 'success',
                        title: "Success",
                        text: data.message
                    }).then((result) => {
                        if (result.isConfirmed) {

                            window.location.href = '@Url.Action("BeneficiaryList", "Beneficiaries")';

                        }
                    });
                }

                if (data.status == false) {
                   Swal.fire({
                      icon: 'error',
                      title: "Error",
                      text: data.message
                    }).then((result) => {
                      if (result.isConfirmed) {
                        window.location.href = '@Url.Action("BeneficiaryList", "Beneficiaries")';
                      }
                    });

                }
                selectedValues = [];
            }
        });
    };

    function isValidEmail(email) {
        // Regular expression for basic email validation
        var emailRegex = /^([\w-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
        return emailRegex.test(email);
    }

    function ValidateNumber(MobNumber) {
        var selectedCode = $('#countryCode').val();
        if (selectedCode == "+256") {
            if (MobNumber.length != 9) {
                return false;
            }
        }
        if (selectedCode == "+91") {
            if (MobNumber.length != 10) {
                return false;
            }
        }

        return true;
    }



</script>














