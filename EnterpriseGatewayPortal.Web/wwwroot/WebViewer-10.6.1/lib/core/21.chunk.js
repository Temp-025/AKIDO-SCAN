/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{568:function(wa,ta,h){h.r(ta);var pa=h(0),na=h(7),oa=h(3);wa=h(55);var ka=h(33),la=h(14);h=function(){function ha(){this.init()}ha.prototype.init=function(){this.Tia=!1;this.hg=this.Vn=this.connection=null;this.wv={};this.ga=this.$K=null};ha.prototype.jEa=function(z){for(var y=this,r=0;r<z.length;++r){var n=z[r];switch(n.at){case "create":this.wv[n.author]||(this.wv[n.author]=n.aName);this.Asa(n);break;case "modify":this.ga.fr(n.xfdf).then(function(b){y.ga.sb(b[0])});
break;case "delete":this.ga.fr("<delete><id>"+n.aId+"</id></delete>")}}};ha.prototype.Asa=function(z){var y=this;this.ga.fr(z.xfdf).then(function(r){r=r[0];r.authorId=z.author;y.ga.sb(r);y.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[r])})};ha.prototype.Xra=function(z,y,r){this.Vn&&this.Vn(z,y,r)};ha.prototype.preloadAnnotations=function(z){this.addEventListener("webViewerServerAnnotationsEnabled",this.Xra.bind(this,z,"add",{imported:!1}),{once:!0})};ha.prototype.initiateCollaboration=function(z,
y,r){var n=this;if(z){n.hg=y;n.ga=r.ma();r.addEventListener(na.h.DOCUMENT_UNLOADED,function(){n.disableCollaboration()});n.PEa(z);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var a=JSON.parse(b.responseText);n.connection=exports.da.cGa(Object(ka.k)(n.hg,"blackbox/"),"annot");n.$K=a.id;n.wv[a.id]=a.user_name;n.ga.ST(a.id);n.connection.wJa(function(e){e.t&&e.t.startsWith("a_")&&e.data&&n.jEa(e.data)},function(){n.connection.send({t:"a_retrieve",
dId:z});n.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[n.wv[a.id],n.$K])},function(){n.disableCollaboration()})}catch(e){Object(oa.g)(e.message)}});b.open("GET",Object(ka.k)(this.hg,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();n.Tia=!0;n.ga.X8(function(a){return n.wv[a.Author]||a.Author})}else Object(oa.g)("Document ID required for collaboration")};ha.prototype.disableCollaboration=function(){this.Vn&&(this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Vn),this.Vn=
null);this.connection&&this.connection.Xs();this.ga&&this.ga.ST("Guest");this.init();this.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ha.prototype.PEa=function(z){var y=this;this.Vn&&this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Vn);this.Vn=function(r,n,b){return Object(pa.b)(this,void 0,void 0,function(){var a,e,f,w,ba,ea,fa,x,ca;return Object(pa.d)(this,function(aa){switch(aa.label){case 0:if(b.imported)return[2];a={t:"a_"+n,dId:z,annots:[]};return[4,y.ga.V0()];case 1:e=
aa.ba();"delete"!==n&&(f=(new DOMParser).parseFromString(e,"text/xml"),w=new XMLSerializer);for(ba=0;ba<r.length;ba++)ea=r[ba],x=fa=void 0,"add"===n?(fa=f.querySelector('[name="'+ea.Id+'"]'),x=w.serializeToString(fa),ca=null,ea.InReplyTo&&(ca=y.ga.wf(ea.InReplyTo).authorId||"default"),a.annots.push({at:"create",aId:ea.Id,author:y.$K,aName:y.wv[y.$K],parent:ca,xfdf:"<add>"+x+"</add>"})):"modify"===n?(fa=f.querySelector('[name="'+ea.Id+'"]'),x=w.serializeToString(fa),a.annots.push({at:"modify",aId:ea.Id,
xfdf:"<modify>"+x+"</modify>"})):"delete"===n&&a.annots.push({at:"delete",aId:ea.Id});0<a.annots.length&&y.connection.send(a);return[2]}})})}.bind(y);this.ga.addEventListener(la.a.Events.ANNOTATION_CHANGED,this.Vn)};ha.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ha}();Object(wa.a)(h);ta["default"]=h}}]);}).call(this || window)
