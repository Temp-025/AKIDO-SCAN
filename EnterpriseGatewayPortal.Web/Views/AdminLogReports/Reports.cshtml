@model EnterpriseGatewayPortal.Web.ViewModel.AdminLogReports.AdminLogReportViewModel

@using EnterpriseGatewayPortal.Web.Enums
@using EnterpriseGatewayPortal.Web.Models

@{
    ViewBag.Breadcrumb = new List<BreadCrumbModel>
{
        new BreadCrumbModel { Title = "Administration - Activity Reports", Url = "",IconKey = "activityReports"}
    };
}

@{
    ViewData["Title"] = "Reports";
}

@{
    await Html.RenderPartialAsync("_AlertBox");
}

<style>

    .dropdown-menu > li.active:hover > a, .dropdown-menu > li.active > a, .dropdown-menu > li:hover > a {
        width: fit-content;
    }

    .typeahead.dropdown-menu li.active,
    .typeahead.dropdown-menu li.active a {
        color: black !important;
        width:100%;
    }

    .typeahead {
        width: 100%;
        overflow-y: auto;
        white-space: nowrap;
        scrollbar-width: thin;
    }

    .custom-check-box {
        margin-right: 5px;
        -webkit-print-color-adjust: exact;
        vertical-align: top;
        background-repeat: no-repeat;
        background-position: 50%;
        background-size: contain;
        position: relative !important;
        width: 1.125rem;
        height: 1.125rem;
        background-color: #fff;
        border: .125rem solid rgba(0,0,0,0.3);
    }

        .custom-check-box:hover {
            outline: auto;
            outline-color: #5d9ceca3;
        }

    .classshide {
        display: none !important;
    }


    /* ----------- Select dropdown css -------------*/

    .select2-container {
        width: 100% !important;
    }

        .select2-container .select2-selection--single {
            border-radius: 8px;
            align-items: center;
            box-sizing: border-box;
            justify-content: center;
            height: 40px !important;
            border: 1px solid #E2E8F0 !IMPORTANT;
            color: #3E4046 !important;
        }

    .selection {
        width: 100% !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        color: #3E4046 !important;
        font-size: 14px;
        font-family: inherit;
        padding: 5px 10px;
    }


    /* Remove default arrow */
    .select2-container--default .select2-selection--single .select2-selection__arrow b {
        border: none !important; /* removes default triangle */
    }

    /* Add your custom arrow */
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        background: url('@Url.Content("~/assets/images/dropDown-icon-brown.svg")');
        background-repeat: no-repeat;
        background-size: 16px 16px;
        width: 19px;
        top: 11px;
        vertical-align: middle;
        height: 100%;
    }

    .select2-search__field {
        display: none !important;
    }

    .select2-container .select2-dropdown.select2-dropdown--below {
        top: -5px !important;
    }

    .select2-container .select2-search.select2-search--dropdown {
        padding: 0 !important;
    }

</style>
<div class="classshide">
    <div id='viewer'></div>
</div>
<label class="sub-label" style="padding-left: 41px">Activity Reports</label>
<div class="column">
    <div class="col-md-12 plr">
        <div class="card-custom">
            <div class="card-body">
                <form method="post" asp-action="Reports">
                    
                    <div class="form-group col-md-12">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label asp-for="UserName" class="col-form-label"></label>
                                <input asp-for="UserName" class="form-control" type="text" id="AdminUsernames" />

                            </div>
                            <div class="form-group col-md-6">
                                <label asp-for="ModuleName" class="col-form-label"></label>
                                <select asp-for="ModuleName" asp-items="Html.GetEnumSelectList<ModuleName>()" class="form-control select2 mb-3">
                                    <option value="">All</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label asp-for="StartDate" class="col-form-label"></label>
                                <input class="form-control datepicker" asp-for="StartDate" type="text">
                                <span asp-validation-for="StartDate" class="text-danger"></span>
                            </div>

                            <div class="form-group col-md-6">
                                <label asp-for="EndDate" class="col-form-label"></label>
                                <input class="form-control datepicker" asp-for="EndDate" type="text">
                                <span asp-validation-for="EndDate" class="text-danger"></span>
                            </div>

                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label asp-for="PerPage" class="col-form-label"></label>
                                <select asp-for="PerPage" class="form-control select2 mb-3">
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                </select>
                                <span asp-validation-for="PerPage" class="text-danger"></span>
                            </div>
                        </div>
                        <div style="padding-right: 10px">
                            <div style="float: left;margin-top: 5px;padding-left: 22px;">
                                <b>NOTE: </b>(*) Mark fields are mandatory.
                            </div>
                            <div class="d-flex justify-content-end">


                                <button type="submit" class="btn btn-primary uaeid-primary" style="float:left;">
                                    Apply
                                </button>&nbsp;&nbsp;
                                <button type="button" class="btn btn-other" onclick="resetFields()">Clear</button>

                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    @if (Model.Reports != null)
    {
        if (TempData["SearchAdminReports"] != null)
        {
            TempData.Keep("SearchAdminReports");
        }
        @await Html.PartialAsync("_AdminReportsTable", Model.Reports)
    }
</div>


<link href="~/assets/css/jquery-ui.css" rel="stylesheet" type="text/css" asp-append-version="true" />
<script src="~/assets/js/bootstrap3-typeahead.min.js" asp-append-version="true"></script>
@section Scripts {

    @* <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script> *@
    <script src="~/assets/js/jquery-ui.js"></script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function () {

            $('#networkOverlay').hide();
            document.getElementById("navigationNetworkOverlay").style.display = "none";

            $("#Administration > a")
                .attr("aria-expanded", "true")
                .addClass("active");

            $("#Administration")
                .addClass("submenu-active show");

            $("#Administration .submenu")
                .addClass("show");

            $('#Reports').addClass('active');


            $('.select2').select2();
            if ($('#sidebar ul li.dropdown.active')) {
                $('#sidebar ul li.dropdown.active ul').addClass('show');
                $('#adminLogReportMenuItem').addClass('active');
                $('#sidebar ul li.dropdown.active a.nav-link.drop-logo').attr('aria-expanded', 'true');
            }

            /*For Beadcrum Start*/
            $('#homeMenu').addClass('breadcrumb-item').append('Activity Reports');
            $('#mainMenu').addClass('breadcrumb-item active').append('Admin');
            $('#subMenu').removeClass('breadcrumb-item');
            /*For Beadcrum End*/

            var today = new Date();
            //$('.datepicker').datepicker({
            //    dateFormat: "yy-mm-dd",
            //    changeMonth: true,
            //    changeYear: true,
            //    maxDate: new Date(today.getFullYear(), today.getMonth(), today.getDate())
            //});

            $("#StartDate").datepicker({
                dateFormat: "yy-mm-dd",
                defaultDate: "+1w",
                changeMonth: true,
                numberOfMonths: 1,
                maxDate: new Date(today.getFullYear(), today.getMonth(), today.getDate()),
                onClose: function (selectedDate) {
                    $("#EndDate").datepicker("option", "minDate", selectedDate);
                }
            });

            $("#EndDate").datepicker({
                dateFormat: "yy-mm-dd",
                defaultDate: "+1w",
                changeMonth: true,
                numberOfMonths: 1,
                maxDate: new Date(today.getFullYear(), today.getMonth(), today.getDate()),
                onClose: function (selectedDate) {
                    $("#StartDate").datepicker("option", "maxDate", selectedDate);
                }
            });
        });

        function resetFields() {
            $('select').val('');
            $("input:text").val("");
            $("input:checkbox").prop('checked', false);
            $('#PerPage option:first').prop('selected', true);
        }

        $("#AdminUsernames").typeahead({
            minLength: 2,
            items: 5,
            source: function (request, response) {
                let type = $('#AdminUsernames').val();
                if (type == "")
                    return;

                $.ajax({
                    url: '@Url.Action("GetAdminLogNames", "AdminLogReports")',
                    data: {
                        "searchUser": request
                    },
                    type: "GET",
                    contentType: "json",
                    error: ajaxErrorHandler,
                    success: function (data) {
                        items = []; 
                        map = {};
                        $.each(data, function (i, item) {
                            var id = i;
                            var name = item;
                            map[name] = {
                                id: id,
                                name: name
                            };
                            items.push(name);
                        });
                        response(items);
                    }
                });
            },
            updater: function (item) {
                return item;
            }
        });
    </script>
    <style>
        #note {
            padding-right: 10px;
            display: flex;
            justify-content: flex-end;
            padding-bottom: 15px;
        }
    </style>
}