@using System.Security.Claims;

@inject IConfiguration Configuration
@inject IHttpContextAccessor httpContextAccessor

@{
    var id = int.Parse(User.FindFirst(ClaimTypes.UserData).Value);
    var IDPLogin = User.FindFirst("IDPLogin").Value;
    var adminUserExist = User.FindFirst("AdminUserExist").Value;
    var KYCAdminExist = User.FindFirst("KYCAdminUserExist").Value;
    var RoleId = User.FindFirst("UserRoleID").Value;
    var businessUserExist = User.FindFirst("UserExist").Value;
    var spoc_email = User.FindFirst("SpocEmail").Value;
    var user_email = User.FindFirst("userEmail").Value;
    var prePaidOrPostPaid = User.FindFirst("PrePaidOrPostPiad").Value;
    var userRoleName = User.FindFirst("userRoleName")?.Value;
    var suid = "";
    var template = "false";
    var bulkSign = "false";
    if (IDPLogin == "true")
    {
        suid = User.FindFirst("Suid").Value;
    }
    if (IDPLogin == "true" && businessUserExist == "true")
    {
        template = User.FindFirst("Template").Value;
        bulkSign = User.FindFirst("BulkSign").Value;
    }
    var PresentlayoutType = Context.Request.Cookies["NavigationLayout"];
    var theme = httpContextAccessor.HttpContext.Request.Cookies["theme"];
    var uaeidTheme = httpContextAccessor.HttpContext.Request.Cookies["theme"];
    var Presentlayout = Context.Request.Cookies["NavigationLayout"];
    var layoutType = Context.Request.Cookies["NavigationLayout"];
}

<style>
    .checkbox-header {
        display: inline-flex !important;
        align-items: center; /* Align vertically center */
        gap: 16px; /* Item spacing = 16px */
        cursor: pointer;
        position: relative;
        color: #232528;
        margin-top: 0.5rem;
    }

    /* Checkbox itself */
    .custom-check-box {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 20px;
        height: 20px;
        border: 1px solid #CBA344;
        border-radius: 4px;
        background-color: #fff;
        cursor: pointer;
        position: relative;
        z-index: 2;
        transition: background-color 0.2s, border-color 0.2s;
    }

        /* Checkmark style */
        .custom-check-box:checked {
            background-color: #CBA344;
            border-color: #92722A;
        }

            .custom-check-box:checked::after {
                content: "✔";
                color: white;
                font-size: 14px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -55%);
            }

    /* Hover effect (circle background) */
    .checkbox-header::before {
        content: "";
        position: absolute;
        left: -7px;
        top: -7px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: transparent;
        z-index: 1;
        transition: background-color 0.2s ease-in-out;
    }

    .checkbox-header:hover::before {
        background-color: #F9F7ED;
    }

    .checkbox-header input[type="checkbox"]:checked {
        background-color: #CBA344;
        border-color: #CBA344;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 32px;
        height: 12px;
    }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #808080;
        border-radius: 32px;
        transition: background-color 0.3s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: -2px;
            bottom: -2px;
            background-color: white;
            border: 2px solid #92722a;
            border-radius: 50%;
            transition: transform 0.3s;
        }

    input:checked + .slider:before {
        transform: translateX(14px);
    }

    input:checked + .slider {
        background-color: #d4b565;
    }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

    .profileDropdown {
        box-shadow: 0px 8px 10px -6px rgba(27, 29, 33, 0.1) !important;
        box-shadow: 0px 20px 25px -5px rgba(27, 29, 33, 0.1) !important;
        width: 281px;
    }

</style>

<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top" id="navbar" style="position:relative !important;">
    <div class="container-fluid header-content d-flex justify-content-between align-items-center" style="padding-top:0px !important;">
        @*@{
            var targetUrl = userRoleName == "KYCADMIN"
                ? Url.Action("Index", "KYCDashboard")
                : Url.Action("Index", "Dashboard");
        }
        <a class="navbar-brand" href="#">
            <img id="primary-image" alt="Logo" width="200" height="50"
                 style=" padding: 6px; cursor: pointer; margin-left: -10px; display: block;"
                 src="@Url.Content("~/assets/images/NewUAEIDprimaryImg.svg")"
                 onclick="window.location.href='@targetUrl'" />
        </a>*@

        <i class="ph ph-list" style="font-size:24px; font-weight:500;color:black;cursor:pointer;" id="collapse-button"></i>

        @if (Presentlayout == "BusinessUserLayout" && uaeidTheme == "Uaeid")
        {
            <div class="horizontalNavbar" id="topNavBar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" asp-controller="Dashboard" asp-action="Index" onclick="showLoader()">
                            <i class="dashboardNew-icon"></i> Dashboard
                        </a>
                    </li>
                    @if (User.IsInRole("Document Signing") && businessUserExist == "true")
                    {
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="Documents" asp-action="Index" onclick="showLoader(); Document(event)">
                                <i class="DocumentSigning-icon"></i> Document Signing
                            </a>
                        </li>
                    }
                    @if (User.IsInRole("Bulk signing") && businessUserExist == "true")
                    {
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="bulkSignDropdown" data-toggle="dropdown">
                                <i class="bulkSigning-icon"></i> Bulk Signing
                            </a>
                            <div class="dropdown-menu">
                                @if (User.IsInRole("Templates") && template == "true")
                                {
                                    <a class="dropdown-item" asp-controller="DocumentTemplates" asp-action="Index" onclick="Template(event)">Templates</a>
                                }
                                @if (User.IsInRole("Transactions") && bulkSign == "true")
                                {
                                    <a class="dropdown-item" asp-controller="BulkSign" asp-action="GetBulkSigDataList" onclick="Transaction(event)">Transactions</a>
                                }
                            </div>
                        </li>
                    }
                </ul>
            </div>
        }

        <div class="d-flex align-items-center">
            <div class="dropdown">
                <a class="nav-link dropdown-toggle custom-profile-dropdown" href="#" id="navbarDropdown" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                   style="color: rgba(57, 50, 50, 1); text-transform: capitalize; display: flex; align-items: center; gap: 6px;">

                    <i class="fa fa-user-circle fa-2x"></i>

                    <div class="d-flex flex-column" style="padding-left:4px;">
                        <span style="font-weight: 700; font-size: 14px;line-height: 20px;"> @User.Identity.Name</span>
                        <span style="font-weight: 400; font-size: 12px;line-height: 16px;text-transform:none !important;">@user_email</span>
                    </div>

                    <img src="~/assets/images/ProfileSideIcon.svg" alt="Profile Menu" style="width:14px; height:14px;" />
                </a>

                <!-- Here's the magic. Add the .animate and .slide-in classes to your .dropdown-menu and you're all set! -->
                <div class="dropdown-menu dropdown-menu-right animate slideIn profileDropdown" aria-labelledby="navbarDropdown">
                    @*<div class="d-flex align-items-center flex-row"
                         style="border-bottom: 1px solid #F7F7F7; padding: 8px 12px; ">
                        <i class="fa fa-user-circle fa-2x"></i>
                        <div class="d-flex flex-column" style="padding-left:12px;">
                            <span style="font-weight: 700; font-size: 14px;line-height: 20px;"> @User.Identity.Name</span>
                            <span style="font-weight: 400; font-size: 12px;line-height: 16px;">@user_email</span>
                        </div>
                    </div>*@
                    @if ((adminUserExist.ToLower() == "true" || KYCAdminExist.ToLower() == "true") && layoutType != "BusinessUserLayout")
                    {

                        <a class="dropdown-item account-item" asp-controller="UserDashboard" asp-action="Profile">
                            <img src="~/assets/images/ProfileIcon.svg" alt="Account" class="account-icon" />
                            <span class="account-text">Account</span>
                        </a>

                        <a class="dropdown-item account-item" asp-controller="UserDashboard" asp-action="ChangePassword" asp-route-id="@id">
                            <img src="~/assets/images/ChangePassIcon.svg" alt="Change Password" class="account-icon" />
                            <span class="account-text">Change Password</span>
                        </a>

                        @*<a class="dropdown-item account-item" asp-controller="UserDashboard" asp-action="ChangeSecurityQuestion">
                            <img src="~/assets/images/ChangeSecQuesIcon.svg" alt="Change Security Question" class="account-icon" />
                            <span class="account-text">Change Security Question</span>
                        </a>*@

                    }
                    @if (adminUserExist.ToLower() == "true" && businessUserExist.ToLower() == "true")
                    {

                        if (layoutType == "BusinessUserLayout")
                        {
                           <div class="dropdown-item account-item layout-toggle" onclick="ChangeLayout('AdminLayout')">
                               <img src="~/assets/images/AdminPanelIcon.svg" alt="Admin Panel" class="account-icon" />
                               <span class="account-text">Admin Panel</span>
                           </div>
                        }
                        else
                        {
                            <div class="dropdown-item account-item layout-toggle" onclick="ChangeLayout('BusinessUserLayout');">
                                <img src="~/assets/images/BusinessUserPanelIcon.svg" alt="Business User Panel" class="account-icon" />
                                <span class="account-text">Business User Panel</span>
                            </div>
                        }
                    }

                        <a href="javascript:void(0)"
                           class="dropdown-item account-item layout-toggle"
                           onclick="toggleSwitch(event)">
                            <img src="~/assets/images/ChangeLayoutIcon.svg" alt="Change layout" class="account-icon" />

                            <span class="account-text">
                                @(layoutType == "Vertical" ? "Vertical" : "Horizontal")
                            </span>

                            <label class="switch" for="navLayoutToggle" style="margin-left:auto;" onclick="event.stopPropagation();">
                                <input type="checkbox" id="navLayoutToggle"
                                       @(layoutType == "Vertical" ? "checked" : "")
                                       onchange="onLayoutSwitchChanged(event)" />
                                <span class="slider"></span>
                            </label>
                        </a>



                    <hr class="header-hr" />

                    @if (IDPLogin.ToLower() == "true")
                    {
                        <a class="dropdown-item account-item logout-item" asp-controller="Logout" asp-action="Index1">
                            <img src="~/assets/images/LogoutIcon.svg" alt="Logout" class="account-icon" />
                            <span class="account-text">Logout</span>
                        </a>
                    }
                    else
                    {
                        <a class="dropdown-item account-item logout-item" asp-controller="Logout" asp-action="Index">
                            <img src="~/assets/images/LogoutIcon.svg" alt="Logout" class="account-icon" />
                            <span class="account-text logout-text">Logout</span>
                        </a>
                    }

                </div>
            </div>
        </div>
    </div>
</nav>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    var userSuid = '@suid';
    var idpLogin = '@IDPLogin';
    var bulkSign = '@bulkSign';
    var spoc_Email = '@spoc_email';
    var user_Email = '@user_email';
    var prePaidOrPostPaid = '@prePaidOrPostPaid';

    $(document).ready(function () {
        var collapseButton = document.getElementById('collapse-button');

        var sidebar = document.querySelector(".sidebar");
        var nsidebar = document.querySelector(".nsidebar");

        collapseButton.addEventListener('click', function () {
            sidebar.classList.toggle('sactive');
            nsidebar.classList.toggle('sactive');

            const rangeSelector = document.querySelector(".range-selector");
            if (rangeSelector !== null) {
                rangeSelector.classList.toggle("range-small");
            }

            // Toggle logos
            if ($('#primary-image').is(':visible')) {
                $('#primary-image').hide();
                $('#secondaryImage').show();
                $('.main-wrapper').css('margin-left', '8px');
            } else {
                $('#primary-image').show();
                $('#secondaryImage').hide();
                $('.main-wrapper').css('margin-left', '1px');
            }
        });
    });


    function onLayoutSwitchChanged(e) {
        e.stopPropagation();

        setTimeout(() => {
            toggleNavLayout();
        }, 1000);
    }

    function toggleNavLayout() {
        const isVertical = document.getElementById('navLayoutToggle').checked;
        const layout = isVertical ? 'Horizontal' : 'Vertical';
        document.cookie = "HeaderNavigationLayout=" + layout + "; path=/";
        $("#networkOverlay").show();
        location.reload();
    }

    function customChange(ltype) {
        document.cookie = "HeaderNavigationLayout=" + ltype + "; path=/";
        applyNavLayout();
    }

    function toggleSwitch(event) {
        event.stopPropagation();

        const checkbox = document.getElementById("navLayoutToggle");

        checkbox.checked = !checkbox.checked;

        checkbox.dispatchEvent(new Event("change"));
    }


    function ChangeLayout(layoutType) {
        $.ajax({
            url: '@Url.Action("SetLayout", "Home")',
            type: 'POST',
            data: { Layout: layoutType },
            success: function (response) {
                window.location.href = response.redirectUrl;
            },
            error: function (xhr, status, error) {
                console.error("Error setting layout:", error);
            }
        });
    }

    function Template(event) {
        event.preventDefault();
        if (idpLogin === "false") {
            Swal.fire({ icon: 'info', title: "Information", text: "Login with UAEID to access this module" });
        } else {
            window.location.href = '@Url.Action("Index", "DocumentTemplates")';
        }
    }

    function Transaction(event) {
        event.preventDefault();
        if (idpLogin === "false") {
            Swal.fire({ icon: 'info', title: "Information", text: "Login with UAEID to access this module" });
        } else {
            window.location.href = '@Url.Action("GetBulkSigDataList", "BulkSign")';
        }
    }

    function Document(event) {
        event.preventDefault();
        if (idpLogin === "false") {
            Swal.fire({ icon: 'info', title: "Information", text: "Login with UAEID to access this module" });
        } else {
            window.location.href = '@Url.Action("Index", "Documents")';
        }
    }

    function showLoader() {
        document.getElementById("navigationNetworkOverlay").style.display = "block";
    }

    $('#sidebarCollapse').on('click', function () {
        $('#sidebar').toggleClass('active');
    });

    function applyNavLayout(isVertical) {
        const sidebar = document.getElementsByClassName("nsidebar");
        const mainHorizontalNav = document.getElementById("mainHorizontalNav");
        const hlogo = document.getElementById("primary-image");
        const profile = document.getElementById("navbarNavDropdown");
        const hicon = document.getElementById("sidebarCollapse");

        if (hicon) {
            hicon.style.display = isVertical ? "" : "none";
        }

        if (profile) {
            profile.style.justifyContent = isVertical ? "flex-end" : "space-between";
        }

        for (let i = 0; i < sidebar.length; i++) {
            sidebar[i].style.display = isVertical ? "block" : "none";
        }

        if (mainHorizontalNav) {
            mainHorizontalNav.style.display = isVertical ? "none" : "flex";
            mainHorizontalNav.style.justifyContent = isVertical ? "flex-end" : "";
            hlogo.style.display = isVertical ? "none" : "block";
        }
    }


</script>

<div id="navigationNetworkOverlay" style="display: none">
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
