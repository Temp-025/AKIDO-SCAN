@model EnterpriseGatewayPortal.Web.ViewModel.Wallet.WalletConfigurationViewModel

@{
	ViewData["Title"] = "Wallet Configuration";
}

<style>
	.custom-card {
		border-radius: 12px;
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		padding: 20px;
		background: #ffffff;
	}

	.custom-fieldset {
		border: none;
		padding: 15px;
		border-radius: 8px;
		margin-bottom: 15px;
	}

		.custom-fieldset legend {
			font-size: 1rem;
			font-weight: bold;
			color: #333;
		}

	.nested-fieldset {
		padding-left: 15px;
	}

	.form-check-label {
		font-weight: 500;
	}

	.custom-table th, .custom-table td {
		vertical-align: middle;
	}

	#emailDataTable_wrapper .dataTables_scrollBody,
	#attributeTable_wrapper .dataTables_scrollBody {
		overflow-x: auto;
		scrollbar-width: none; /* For Firefox */
	}

		#emailDataTable_wrapper .dataTables_scrollBody::-webkit-scrollbar,
		#attributeTable_wrapper .dataTables_scrollBody::-webkit-scrollbar {
			display: none; /* For Chrome, Safari, and Edge */
		}

	.card-content {
		overflow-y: auto; /* Add overflow-y to enable vertical scrolling if needed */
		/* max-height: 645px; /* Add max-height to limit the height of the card content */ */
	}

	.table-container {
		width: 100%;
		overflow-x: auto;
	}

	.table-container {
		background-color: white;
		border-radius: 10px;
		overflow: hidden;
		margin-bottom: 24px;
		/* padding-top: 11px; */
		padding-left: 0px !important;
		padding-right: 37px;
		margin-top: -18px;
		/* padding-bottom: 33px; */
	}

	.container {
		width: 100%;
		display: flex;
		flex-direction: column;
		align-items: center;
		margin-top: 10px;
	}

	.qwer {
		display: flex;
		justify-content: space-between;
		margin-top: 12px;
	}


	.step-label {
		position: absolute;
		bottom: -24px; /* Adjust this value to control the space between the circle and label */
		width: 100px; /* Set the width based on your design */
		text-align: center;
		white-space: nowrap; /* Prevent text from wrapping */
		font-size: 15px;
	}

	.container .steps {
		display: flex;
		width: 76%;
		align-items: center;
		justify-content: space-between;
		position: relative;
		margin: 8px 30px;
		height: 0px;
	}

	.steps .circle {
		display: flex;
		align-items: center;
		justify-content: center;
		height: 35px;
		width: 35px;
		color: #999;
		background: #e0e0e0;
		/* border-radius: 50%; */
		border: 3px solid #e0e0e0;
		z-index: 1;
		transition: all 300ms ease;
		overflow: hidden;
	}

		.steps .circle img {
			height: 56%;
			width: 47%;
		}

		.steps .circle.active {
			border-color: #B68A35;
			color: white;
			background-color: #B68A35;
		}


	.steps .progress-bar {
		position: absolute;
		top: 0%;
		left: 3%;
		transform: translateY(-50%);
		height: 3px;
		width: 94%;
		background: #e0e0e0;
		z-index: 0;
	}

	.progress-bar .indicator {
		position: absolute;
		height: 100%;
		width: 0%;
		background: #B68A35;
		transition: all 300ms ease;
	}

	@@media (max-width: 900px) {
		.App:not(.is-in-desktop-only-mode) .Header, .App:not(.is-in-desktop-only-mode) .Header.Tools {
			height: 0 !important;
			visibility: hidden !important;
		}
	}

	.custom-group {
		display: flex;
		flex-direction: row;
		align-items: center;
		margin-bottom: 15px; /* Adjusts spacing between form groups */
	}

		.custom-group label {
			margin-right: 10px; /* Adjusts spacing between label and input */
			min-width: 120px; /* Set a fixed width for labels to align them vertically */
			text-align: right; /* Aligns the text of the labels */
		}

	.custom-input {
		flex: 1; /* Makes input take the remaining space */
		max-width: 70%; /* Adjusts the width of the input field */
	}

	.classshide {
		display: none !important;
	}

	.content {
		min-height: 84vh;
		transition: all 0.3s;
		height: 592px !important;
	}

	.dataTables_scrollHead {
		background: white;
		top: 0;
		z-index: 10;
	}

	.tree {
		list-style-type: none;
		padding-left: 0;
	}

		.tree label {
			cursor: pointer;
			font-weight: 500;
		}

	.nested {
		display: none;
		padding-left: 20px;
		border-left: 2px solid #B68A35;
	}

	.tree input[type="checkbox"]:checked ~ .nested {
		display: block;
	}

	.formats-container {
		border: 1px solid #ccc; /* Border color */
		border-radius: 10px; /* Rounded corners */
		padding: 19px; /* Space inside the border */
		margin-top: 10px; /* Spacing above the container */
	}

	@@keyframes glow {
		0% {
			box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
		}

		50% {
			box-shadow: 0 0 20px rgba(0, 123, 255, 1);
		}

		100% {
			box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
		}
	}

	.highlight {
		animation: glow 1s ease-in-out infinite alternate;
	}

	#maincard {
		max-height: 100vh;
		overflow-y: auto; /* Enables scrolling if content overflows */
		scrollbar-width: thin; /* Firefox */
		scrollbar-color: transparent transparent; /* Transparent thumb and track */
	}

		/* Hide scrollbar for Webkit browsers (Chrome, Safari, Edge) */
		#maincard::-webkit-scrollbar {
			width: 0px; /* Hide scrollbar */
			background: transparent; /* Transparent background */
		}

		/* Optional: Ensure scrolling still works */
		#maincard::-webkit-scrollbar-thumb {
			background: transparent; /* Fully transparent scrollbar */
		}

	.form-check-label {
		font-size: 15px;
		margin-top: 6px; /* Adjust font size */
	}

	.form-check {
		margin-bottom: 10px; /* Space between checkboxes */
		display: flex;
		align-items: center;
		gap: 8px; /* Space between checkbox and label */
	}

	#shadow_card{
		box-shadow: 0 0px 6px 0 rgb(0 0 0 / 20%) !important;
	}

	/*-----------------------------------------------------------------*/
	/* Container style */
	.checkbox-primary {
		display: inline-flex !important;
		align-items: center; /* Align vertically center */
		gap: 16px; /* Item spacing = 16px */
		cursor: pointer;
		position: relative;
		color: #232528;
		margin-top: 0.5rem;
		margin-bottom:13px;
	}

	/* Checkbox itself */
	.custom-check-box {
		appearance: none;
		-webkit-appearance: none;
		-moz-appearance: none;
		width: 20px;
		height: 20px;
		border: 1px solid #CBA344;
		border-radius: 4px;
		background-color: #fff;
		cursor: pointer;
		position: relative;
		z-index: 2;
		transition: background-color 0.2s, border-color 0.2s;
	}

		/* Checkmark style */
		.custom-check-box:checked {
			background-color: #CBA344;
			border-color: #92722A;
		}

			.custom-check-box:checked::after {
				content: "✔";
				color: white;
				font-size: 14px;
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -55%);
			}

	/* Hover effect (circle background) */
	.checkbox-primary::before {
		content: "";
		position: absolute;
		left: -7px;
		top: -7px;
		width: 40px;
		height: 40px;
		border-radius: 50%;
		background-color: transparent;
		z-index: 1;
		transition: background-color 0.2s ease-in-out;
	}

	.checkbox-table::before {
		left: -11.5px !important;
		top: -11.5px !important;
	}
	.checkbox-primary:hover::before {
		background-color: #F9F7ED;
	}

	.checkbox-primary input[type="checkbox"]:checked {
		background-color: #CBA344;
		border-color: #CBA344;
	}


	fieldset {
		border: 1px solid #E2E8F0 !IMPORTANT;
		border-radius: 8px;
		padding: 10px !important;
		border-radius: 5px;
		display: flex;
		flex-direction: column;
	}

</style>
<div class="classshide">
	<div id='viewer'></div>
</div>
<div class="row">
	<div class="col-md-12">
		<div class="card shadow-lg" id="maincard">
			<div class="card-body">
				<div class="row">
					<div class="col-md-12 container">
						<div class="steps">
							<span class="circle active">
								<span style="font-size: 15px; font-weight: bold; color:white !important;">1</span>
							</span>
							<span class="circle">
								<span style="font-size: 15px; font-weight: bold;color:white !important;">2</span>
							</span>
							<span class="circle">
								<span style="font-size: 15px; font-weight: bold;color:white !important;">3</span>
							</span>
							<span class="circle">
								<span style="font-size: 15px; font-weight: bold; color:white !important;">4</span>
							</span>
							<span class="circle">
								<span style="font-size: 15px; font-weight: bold; color:white !important;">5</span>
							</span>
							<div class="progress-bar">
								<span class="indicator"></span>
							</div>
						</div>


						<div class="qwer">
							<span class="step-label" style="left: 10%;font-size:13px;">Select Configuration</span>
							<span class="step-label" style="left: 28.5%;font-size:13px;">Attributes</span>
							<span class="step-label" style="left: 47%;font-size:13px;">Select Verifier</span>
							<span class="step-label" style="left: 64%;font-size:13px;">Credential Consent</span>
							<span class="step-label" style="left: 82.5%;font-size:13px;">Send Request</span>
						</div>
					</div>


					@* 	<div class="col-md-3" id="configuration" style="display:flex;flex-direction:row;align-items:center;gap:15%;justify-content:center">
					<button type="button" variant="outlined" id="backButton1" class="btn btn-danger classshide" style="margin-left:18px; float:right">Back</button>
					<button type="button" variant="outlined" id="nextButton" class="btn btn-primary greenButton" style="margin-left:18px; float:right">Next</button>

					</div>
					<div class="col-md-3 classshide" id="Attributes" style="display:flex;flex-direction:row;align-items:center;gap:15%;justify-content:center">
					<button type="button" id="backButton2" class="btn btn-danger" style="margin-left:18px; float:right">Back</button>

					<button type="button" variant="outlined" id="Continue" class="btn btn-primary greenButton" style="margin-left:18px; float:right">Next</button>

					</div>
					<div class="col-md-3 classshide" id="VerifierEmail" style="display:flex;flex-direction:row;align-items:center;gap:15%;justify-content:center">

					<button type="button" id="backbutton" class="btn btn-danger" style="margin-left:18px; float:right">Back</button>
					<button class="btn btn-primary greenButton SubscribeCredential" type="button">Subscribe Credential</button>

					</div> *@
				</div>

				<br />
				<br /><br />
				<div class="row" id="configurationdiv">

					<div class="col-md-6 mx-auto">
						<div class="form-group">

							<label class="col-form-label s3">Selected Credential</label>
							<input type="text" class="form-control custom-file-input-style2" id="credentialInput"
								   value="@(Model?.CredentialName ?? "N/A")"
								   readonly />
						</div>

						<div class="form-group" style="margin-bottom:-5px;">
							<label class="col-form-label s3">Select Required Standards</label>
							<fieldset>
								<div class="card-default c-checkbox" style="margin-left: 10px; margin-top:5px;">
									@if (Model?.Originalconfiguration != null && Model.Originalconfiguration.Any())
									{
										var groupedFormats = Model.Originalconfiguration
										.Select(x => x.format)
										.Where(f => !string.IsNullOrEmpty(f))
										.Distinct();

										foreach (var format in groupedFormats)
										{
											<label class="checkbox-primary" for="format_@format" style="display: flex !important; margin-left:0;">
												<input type="checkbox" class="form-check-input format-checkbox custom-check-box" id="format_@format" name="selectedFormats" value="@format" style="margin-left:5px;margin-top: 0px;" />
												@format
											</label>

										}
									}
									else
									{
										<div class="alert alert-warning">No wallet configurations available.</div>
									}
								</div>
							</fieldset>
						</div>


					</div>


				</div>

				<div class="row classshide" id="DataAttivutesDiv">
					<!-- Left Side: Table -->
					<div class="col-md-8 mx-auto">
						<div class="card shadow-lg" style="border-radius: 12px; overflow: hidden;">
							<div class="card-body">
								<h5 class="text-primary mb-3" style="color:#B68A35 !important">Data Attributes</h5>
								<div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
									<table id="attributeTable" class="table-striped custom-table table">
										<thead>
											<tr>
												<th>Attribute</th>
												<th class="text-center">Display Name</th>
												<th class="text-center">Data Type</th>
												@* <th class="text-center">Mandatory</th> *@
											</tr>
										</thead>
										<tbody>
											@foreach (var dataAttribute in Model.DataAttributes.Distinct())
											{
												<tr>
													<td>@dataAttribute.Attribute</td>
													<td class="text-center">@dataAttribute.DisplayName</td>
													<td class="text-center">
														@{
															string dataTypeName = dataAttribute.DataType switch
															{
																1 => "Binary",
																2 => "Boolean",
																3 => "Integer",
																4 => "String",
																8 => "DateTime",
																_ => "Unknown"
															};
														}
														@dataTypeName
													</td>
													@* <td class="text-center">
												<input type="checkbox" class="select-checkbox attribute" data-attribute="@dataAttribute.DisplayName">
												</td> *@
												</tr>
											}
										</tbody>

									</table>
								</div>
							</div>
						</div>
					</div>

					<!-- Right Side: Selected Attributes Card -->
					@* <div class="col-md-5">
					<div class="card shadow-lg" style="border-radius: 12px;">
					<div class="card-body">
					<h5 class="text-primary mb-3">Selected Attributes</h5>
					<ul id="selectedAttributes" class="list-group" style="max-height: 250px; overflow-y: auto;">
					<li class="list-group-item text-muted">No attributes selected</li>
					</ul>
					</div>
					</div>
					</div> *@
				</div>


				<div class="row classshide" id="emailDiv">
					<!-- Left Side: Table -->
					<div class="col-md-7">
						<div class="card shadow-lg" style="border-radius: 12px; overflow: hidden;">
							<div class="card-body">
								<h5 class="text-primary mb-3" style="color:#B68A35 !important">Verifier Emails</h5>
								<div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
									<table id="emailDataTable" class="table-striped custom-table table">
										<thead>
											<tr>
												<th>Email</th>
												<th class="text-center">Select</th>
											</tr>
										</thead>
										<tbody>
											@foreach (var email in Model.BulkSignerEmails.bulkSignerList.Distinct())
											{
												<tr>
													<td>@email</td>
													<td class="text-center">
														<label class="checkbox-primary checkbox-table">
														<input type="checkbox" class="custom-check-box select-checkbox VerifierEmails" data-email="@email">
														</label>
														
													</td>
												</tr>
											}
										</tbody>

									</table>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-5">
						<div class="card shadow-lg" style="border-radius: 12px;">
							<div class="card-body">
								<h5 class="text-primary mb-3" style="color:#B68A35 !important">Selected Verifier Emails</h5>
								<ul id="selectedEmails" class="list-group" style="max-height: 250px; overflow-y: auto;">
									<li class="list-group-item text-muted">No Verifier Emails selected</li>
								</ul>
							</div>
						</div>
					</div>
				</div>

				<div class="row classshide justify-content-center" id="credentialConsentDiv">
					<!-- Domain & Days Inputs -->
					<div class="col-md-10 mb-4">
						<div class="card p-4 shadow-sm"  style="border-radius: 12px;">
							<div class="row g-4">
								<!-- Domain Dropdown -->
								<div class="col-md-6">
									<h5 class="col-form-label">Domain</h5>
									<select asp-for="Domain" class="form-control" asp-items="Model.DomainsList">
										<option value="">-- Select Domain --</option>
									</select>
									<span asp-validation-for="Domain" class="text-danger"></span>
								</div>

								<!-- Days Input -->
								<div class="col-md-6">
									<h5 class="col-form-label">Days</h5>
									<input type="number" id="days" name="days" class="form-control date-pick" min="1">
									<span class="text-danger" id="daysValidation"></span>
								</div>
							</div>
						</div>
					</div>

					<!-- Domain Purposes and Selected Purposes -->
					<div class="col-md-10 purpose-container d-none" style="opacity: 0; transition: opacity 0.5s ease;">
						<div class="row g-4">
							<!-- Domain Purposes Table -->
							<div class="col-md-7">
								<div class="card shadow-lg" style="border-radius: 12px;">
									<div class="card-body">
										<h5 class="text-primary mb-3" style="color:#B68A35 !important">Domain Purposes</h5>
										<div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
											<table id="purposeDataTable" class="table-striped custom-table mb-0 table">
												<thead>
													<tr>
														<th>Purpose</th>
														<th class="text-center">Select</th>
													</tr>
												</thead>
												<tbody>
													@foreach (var email in Model.BulkSignerEmails.bulkSignerList.Distinct())
													{
														<tr>
															<td>@email</td>
															<td class="text-center">
																<label class="checkbox-primary checkbox-table">
																	<input type="checkbox" class="custom-check-box select-checkbox DomainPurposes" data-purpose="@email">
																</label>
															</td>
														</tr>
													}
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>

							<!-- Selected Purposes List -->
							<div class="col-md-5">
								<div class="card shadow-lg" style="border-radius: 12px;">
									<div class="card-body">
										<h5 class="text-primary mb-3" style="color:#B68A35 !important">Selected Purposes</h5>
										<ul id="selectedPurposes" class="list-group" style="max-height: 250px; overflow-y: auto;">
											<li class="list-group-item text-muted">No Domain Purposes selected</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>



				<div style="padding-right: 10px">
					<div style="float: right;">

						<div id="configuration">
							<button type="button" variant="outlined" id="backButton1" class="btn btn-other classshide" style="margin-left:18px; float:right">Back</button>
							@* <button type="button" variant="outlined" onclick="ViewConfigurationDetails()" class="btn btn-primary greenButton" id="view-config-btn" style="margin-left:18px; float:left; margin-top: 114px;">View Configuration Details</button>
							*@
							<button type="button" variant="outlined" id="nextButton" class="btn btn-primary uaeid-primary greenButton" style="margin-left:18px; float:right; margin-top: 114px;height: 36px;width: 79px; font-size: 13px;">
								Next
							</button>

						</div>
						<div class="classshide" id="Attributes">
							<button type="button" id="backButton2" class="btn btn-other" style="margin-left:18px; float:left;height: 36px; font-size: 13px;">Back</button>

							<button type="button" variant="outlined" id="Continue" class="btn btn-primary uaeid-primary greenButton" style="margin-left:18px; float:right;height: 36px;width: 79px; font-size: 13px;">Next</button>

						</div>
						<div class="classshide" id="VerifierEmail">

							<button type="button" id="backbutton" class="btn btn-other" style="margin-left:18px; float:left;height: 36px; font-size: 13px;">Back</button>
							&nbsp;&nbsp;
@* 							<button class="btn btn-primary greenButton SubscribeCredential" type="button" style="height: 36px;width: 183px; font-size: 13px;">Subscribe Credential</button>
 *@							<button type="button" variant="outlined" id="Continue2" class="btn btn-primary uaeid-primary greenButton" style="margin-left:18px; float:right;height: 36px;width: 79px; font-size: 13px;">Next</button>

						</div>
						<div class="classshide" id="CredentialConsent" style="margin-bottom: 19px !important;">

							<button type="button" id="backbutton3" class="btn btn-other" style="margin-left:18px; float:left;height: 36px; font-size: 13px;">Back</button>
							&nbsp;&nbsp;
							<button class="btn btn-primary uaeid-primary greenButton SubscribeCredential" type="button" style="height: 36px;width: 183px; font-size: 13px;">Subscribe Credential</button>

						</div>
					</div>

				</div>

			</div>

		</div>
	</div>

</div>





<script>
	$(document).ready(function () {

		$('#networkOverlay').hide();
		document.getElementById("navigationNetworkOverlay").style.display = "none";
	});
	var credentialId = "@(Model?.credentialId ?? "null")";
	var organizationId = "@(Model?.organizationId ?? "null")";

	var steps = document.querySelectorAll('.steps .circle');
	var line = document.querySelector('.progress-bar .indicator');
	// Convert "null" string to actual null in JavaScript if needed
	credentialId = credentialId === "null" ? null : credentialId;
	organizationId = organizationId === "null" ? null : organizationId;
	const domainConsentData = @Html.Raw(Json.Serialize(Model.DomainConsent));
	const domainPurposesMap = @Html.Raw(Json.Serialize(Model.DomainConsent.ToDictionary(
		d => d.id,
		d => d.purposes.Select(p => new { key = p.Key, value = p.Value })
	)));

	// $('select[name="Domain"]').on('change', function () {
	// 		const selectedDomain = $(this).val();
	// 		const $container = $('.purpose-container');

	// 		if (selectedDomain) {
	// 			$container.removeClass('d-none');
	// 			// Trigger animation
	// 			setTimeout(function () {
	// 				$container.css('opacity', 1);
	// 			}, 50); // slight delay ensures CSS transition works
	// 		} else {
	// 			// Hide with fade out effect
	// 			$container.css('opacity', 0);
	// 			setTimeout(function () {
	// 				$container.addClass('d-none');
	// 			}, 300); // match transition time
	// 		}
	// });


	$('select[name="Domain"]').on('change', function () {
		const selectedDomain = $(this).val();
		const $container = $('.purpose-container');
		const $tableBody = $('#purposeDataTable tbody');
		const $selectedList = $('#selectedPurposes');

		// Clear previous data
		$tableBody.empty();
		$selectedList.empty().append('<li class="list-group-item text-muted">No Domain Purposes selected</li>');

		if (selectedDomain && domainPurposesMap[selectedDomain]) {
			const purposes = domainPurposesMap[selectedDomain];

			// Populate table with purposes
			purposes.forEach(purpose => {
				$tableBody.append(`
					<tr>
						<td>${purpose.value}</td>
						<td class="text-center">
								<label class="checkbox-primary checkbox-table">
								<input type="checkbox" class="custom-check-box select-checkbox DomainPurposes" data-purpose="${purpose.key}">
								</label>
						</td>
					</tr>
				`);
			});

			// Animate visibility (always)
			if ($container.hasClass('d-none')) {
				$container.removeClass('d-none');
				setTimeout(() => $container.css('opacity', 1), 50);
			} else {
				$container.css('opacity', 0);
				setTimeout(() => $container.css('opacity', 1), 300); // Smooth fade-in even on switch
			}
		} else {
			// Fade out and hide
			$container.css('opacity', 0);
			setTimeout(() => $container.addClass('d-none'), 200);
		}
	});

	$(document).on('change', '.DomainPurposes', function () {
		const $selectedList = $('#selectedPurposes');
		const selected = $('.DomainPurposes:checked');

		$selectedList.empty();

		if (selected.length === 0) {
			$selectedList.append('<li class="list-group-item text-muted">No Domain Purposes selected</li>');
		} else {
			selected.each(function () {
				const label = $(this).closest('tr').find('td:first').text();
				$selectedList.append(`<li class="list-group-item">${label}</li>`);
			});
		}
	});


	document.querySelectorAll('.format-checkbox').forEach(checkbox => {
		checkbox.addEventListener('change', function () {
			const settingsIcon = document.getElementById('settings-icon');
			const viewConfigBtn = document.getElementById('view-config-btn');
			if (document.querySelectorAll('.format-checkbox:checked').length > 0) {
				settingsIcon.classList.add('highlight');
				viewConfigBtn.classList.add('highlight');
			} else {
				settingsIcon.classList.remove('highlight');
				viewConfigBtn.classList.remove('highlight');
			}
		});
	});


	const checkboxes = document.querySelectorAll(".attribute");
	const selectedAttributesList = document.getElementById("selectedAttributes");

	checkboxes.forEach(checkbox => {
		checkbox.addEventListener("change", updateSelectedAttributes);
	});

	function updateSelectedAttributes() {
		const selectedAttributes = Array.from(checkboxes)
			.filter(cb => cb.checked)
			.map(cb => cb.getAttribute("data-attribute"));

		selectedAttributesList.innerHTML = selectedAttributes.length > 0
			? selectedAttributes.map(attr => `<li class="list-group-item">${attr}</li>`).join('')
			: '<li class="list-group-item text-muted">No attributes selected</li>';
	}

	const verifyerEmail = document.querySelectorAll(".VerifierEmails");
	const selectedEmailList = document.getElementById("selectedEmails");

	verifyerEmail.forEach(checkbox => {
		checkbox.addEventListener("change", function () {
			updateSelectedEmails();
		});
	});

	function updateSelectedEmails() {
		const selectedAttributes = Array.from(verifyerEmail)
			.filter(cb => cb.checked)
			.map(cb => cb.getAttribute("data-email"));

		selectedEmailList.innerHTML = selectedAttributes.length > 0
			? selectedAttributes.map(attr => `<li class="list-group-item">${attr}</li>`).join('')
			: '<li class="list-group-item text-muted">No Verifier Emails selected</li>';
	}

	var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
	var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
		return new bootstrap.Tooltip(tooltipTriggerEl);
	});


	function updateProgressBar(step, color) {

		steps.forEach((stepElement, index) => {
			stepElement.classList[index < step ? 'add' : 'remove']('active');
		});

		var width = ((step - 1) / (steps.length - 1)) * 100;
		line.style.width = width + '%';
		line.style.background = color;
	}

	function updateCircleColors(step, color) {
		steps.forEach((stepElement, index) => {
			stepElement.style.borderColor = index < step ? color : '#e0e0e0';
			stepElement.style.color = index < step ? color : '#e0e0e0';
		});
	}

	$("#nextButton").on("click", function (e) {
		e.preventDefault(); // Prevent default action

		// Check if at least one format checkbox is checked
		if ($(".format-checkbox:checked").length === 0) {
			Swal.fire({ icon: 'error', title: "Error", text: "Please select at least one standard before proceeding." });
			return; // Stop the process if no checkbox is checked
		}

		// Scroll smoothly to the top first, then update the progress bar
		$('#maincard').animate({ scrollTop: 0 }, 300, function () {
			// Once scrolling completes, update UI elements
			$('#DataAttivutesDiv').removeClass("classshide");
			$('#Attributes').removeClass("classshide");
			$('#configurationdiv').addClass("classshide");
			$('#configuration').addClass("classshide");
			$('#emailDiv').addClass("classshide");
			$('#credentialConsentDiv').addClass("classshide");
			$('#CredentialConsent').addClass("classshide");
			updateProgressBar(2, "#B68A35");
			updateCircleColors(2, "#B68A35");
		});
	});



	$("#Continue").on("click", function (e) {
		e.preventDefault(); // Prevent default action (if any)

		$('#maincard').animate({ scrollTop: 0 }, 300, function () {
			$('#DataAttivutesDiv').addClass("classshide");
			$('#Attributes').addClass("classshide");
			$('#configurationdiv').addClass("classshide");
			$('#configuration').addClass("classshide");
			$('#emailDiv').removeClass("classshide");
			$('#VerifierEmail').removeClass("classshide");
			$('#credentialConsentDiv').addClass("classshide");
			$('#CredentialConsent').addClass("classshide");
			updateProgressBar(3, "#B68A35");
			updateCircleColors(3, "#B68A35");
		});
	});

	$("#Continue2").on("click", function (e) {
		e.preventDefault(); // Prevent default action (if any)

		$('#maincard').animate({ scrollTop: 0 }, 300, function () {
			$('#DataAttivutesDiv').addClass("classshide");
			$('#Attributes').addClass("classshide");
			$('#configurationdiv').addClass("classshide");
			$('#configuration').addClass("classshide");
			$('#credentialConsentDiv').removeClass("classshide");
			$('#CredentialConsent').removeClass("classshide");
			$('#emailDiv').addClass("classshide");
			$('#VerifierEmail').addClass("classshide");
			updateProgressBar(4, "#B68A35");
			updateCircleColors(4, "#B68A35");
		});
	});

	$("#backButton2").on("click", function (e) {
		e.preventDefault(); // Prevent default action (if any)

		$('#maincard').animate({ scrollTop: 0 }, 300, function () {
			$('#DataAttivutesDiv').addClass("classshide");
			$('#Attributes').addClass("classshide");
			$('#configurationdiv').removeClass("classshide");
			$('#configuration').removeClass("classshide");
			$('#emailDiv').addClass("classshide");
			$('#VerifierEmail').addClass("classshide");
			$('#credentialConsentDiv').addClass("classshide");
			$('#CredentialConsent').addClass("classshide");
			updateProgressBar(1, "#B68A35");
			updateCircleColors(1, "#B68A35");
		});
	});


	$("#backbutton3").on("click", function (e) {
		e.preventDefault(); // Prevent default action (if any)

		$('#maincard').animate({ scrollTop: 0 }, 300, function () {
			$('#DataAttivutesDiv').addClass("classshide");
			$('#Attributes').addClass("classshide");
			$('#configurationdiv').addClass("classshide");
			$('#configuration').addClass("classshide");
			$('#emailDiv').removeClass("classshide");
			$('#VerifierEmail').removeClass("classshide");
			$('#credentialConsentDiv').addClass("classshide");
			$('#CredentialConsent').addClass("classshide");
			updateProgressBar(3, "#B68A35");
			updateCircleColors(3, "#B68A35");
		});
	});

	$("#backbutton").on("click", function (e) {
		e.preventDefault(); // Prevent default action (if any)

		$('#maincard').animate({ scrollTop: 0 }, 300, function () {
			$('#DataAttivutesDiv').removeClass("classshide");
			$('#Attributes').removeClass("classshide");
			$('#configurationdiv').addClass("classshide");
			$('#configuration').addClass("classshide");
			$('#emailDiv').addClass("classshide");
			$('#VerifierEmail').addClass("classshide");
			updateProgressBar(2, "#B68A35");
			updateCircleColors(2, "#B68A35");
		});
	});


	function ViewCredentialDetails() {

		var dataToSend = { CredentialUId: credentialId };
		$.ajax({
			url: '@Url.Action("ViewCredentialDetails", "WalletCredentialVerification")',
			data: dataToSend,
			type: "GET",
			/*contentType: "json",*/
			error: ajaxErrorHandler,
			beforeSend: function () {
				$('#overlay').show();
			},
			complete: function () {
				$('#overlay').hide();
			},
			success: function (data) {
				if (data != null) {
					$('#modalDialogContentDiv').html(data);
					$('#modalDialogDiv').modal('show');
				}
				else {
					Swal.fire({ icon: 'error', title: "Error", text: "Failed to get payment info" });
				}
			},
			error: ajaxErrorHandler

		});
	}

	function ViewConfigurationDetails() {

		var dataToSend = { CredentialUId: credentialId };
		$.ajax({
			url: '@Url.Action("ViewWalletConfigurationDetails", "Wallet")',
			data: dataToSend,
			type: "GET",
			/*contentType: "json",*/
			error: ajaxErrorHandler,
			beforeSend: function () {
				$('#overlay').show();
			},
			complete: function () {
				$('#overlay').hide();
			},
			success: function (data) {
				if (data != null) {
					$('#modalDialogContentDiv').html(data);
					$('#modalDialogDiv').modal('show');
				}
				else {
					Swal.fire({ icon: 'error', title: "Error", text: "Failed to get payment info" });
				}
			},
			error: ajaxErrorHandler

		});
	}
	// Function to collect selected checkboxes and send data to controller
	$(".SubscribeCredential").on("click", function () {

		var validData = true;
		var selectedAttributes = [];
		var selectedEmails = [];
		var selectedPurposes = [];
		var selectedConfigurations = [];
		var domainName = $('#Domain').val();
		var validity = $('#days').val();

		// Collect all attributes from DataAttributes in the Model
		var allAttributes = @Html.Raw(Json.Serialize(Model.DataAttributes.Distinct()));
		// Iterate over each attribute in DataAttributes
		allAttributes.forEach(function (attribute) {
			var isChecked = $(`.select-checkbox[data-attribute='${attribute.displayName}']`).is(":checked");

			selectedAttributes.push({
				displayName: attribute.displayName,
				attribute: attribute.attribute,
				dataType: attribute.dataType,
				mandatory: isChecked
			});
		});

			if (domainName == null || domainName.trim() === '') {
				$('#Domain').siblings(".text-danger").text("Please select Domain.");
				validData = false;
			}
			 else {
				$('#Domain').siblings(".text-danger").text("");
			}

			if (validity == null || validity.trim() === '') {
				$('#days').siblings(".text-danger").text("Please enter no.of days.");
				validData = false;
			}
			 else {
				$('#days').siblings(".text-danger").text("");
			}

			if (!validData) {
				return;
			}

		// Collect selected emails
		$(".select-checkbox[data-email]:checked").each(function () {
			selectedEmails.push($(this).data("email"));
		});
		if (selectedEmails.length === 0) {

			Swal.fire({ icon: 'error', title: "Validation Error", text: "Please select at least one email before proceeding." });
			return; // Stop the process
		}

		// Collect selected Purposes
		$(".select-checkbox[data-purpose]:checked").each(function () {
			selectedPurposes.push($(this).data("purpose").toString());
		});
		if (selectedPurposes.length === 0) {

			Swal.fire({ icon: 'error', title: "Validation Error", text: "Please select at least one Purpose before proceeding." });
			return; // Stop the process
		}

		// Collect selected configurations (Fixed Selection of Formats)
		$(".form-check-input:checked").each(function () {
			var format = $(this).val(); // Correctly get the format value
			var formatConfig = [];
			var bindingMethods = [];
			var supportedMethods = [];

			// Find all binding methods related to this format
			$(this).closest('.form-check').next('.nested-fieldset').find(".binding-checkbox:checked").each(function () {
				bindingMethods.push($(this).val());
			});

			// Find all supported methods related to this format
			$(this).closest('.form-check').next('.nested-fieldset').find(".supported-checkbox:checked").each(function () {
				supportedMethods.push($(this).val());
			});

			// // Create format configuration object
			// formatConfig.push({
			// 	format: format,
			// 	bindingMethod: bindingMethods.join(", "), // Join multiple selected values
			// 	supportedMethod: supportedMethods.join(", ") // Join multiple selected values
			// });
			formatConfig.push({
				format: format,
				bindingMethod: format === "W3CVC" ? "Decentralized Identifier(DID)"
					: format === "ISO-18013-5 (MDOC)" ? "CBOR Signing and Encryption(ISO-18013-5 MDL)"
						: bindingMethods.join(", "), // Default case

				supportedMethod: format === "W3CVC" ? "key"
					: format === "ISO-18013-5 (MDOC)" ? ""
						: supportedMethods.join(", ") // Default case
			});


			// Append to final configuration list
			selectedConfigurations = selectedConfigurations.concat(formatConfig);
		});

		// $(".DomainPurposes:checked").each(function () {
		//   selectedPurposes.push($(this).data("purpose"));
	 //    });

		var selectedDomainPurpose = {
			domain: domainName,
			purposesList: selectedPurposes
		};

		// Construct JSON object
		var verifyCredential = {
			credentialId: credentialId, // Placeholder (Ensure it's properly assigned)
			organizationId: organizationId, // Placeholder (Ensure it's properly assigned)
			//organizationId: "0763a957-3410-4500-8763-841ebb463090",
			attributes: selectedAttributes,
			configuration: selectedConfigurations,
			emails: selectedEmails,
			domainConfig : selectedDomainPurpose,
			validity : validity,
		};


		// AJAX Call to Controller
		$.ajax({
			url: '@Url.Action("AddCredentialVerificationRquest", "WalletCredentialVerification")',
			type: 'POST',
			contentType: 'application/json',
			data: JSON.stringify(verifyCredential),
			beforeSend: function () {
				$('#overlay').show();
			},
			complete: function () {
				$('#overlay').hide();
			},
			success: function (data) {
				if (data.success) {
					$('#DataAttivutesDiv, #Attributes, #configurationdiv, #configuration').addClass("classshide");
					$('#emailDiv, #VerifierEmail').removeClass("classshide");
					updateProgressBar(4, "#B68A35");
					updateCircleColors(4, "#B68A35");

					window.scrollTo(0, 0);

					Swal.fire({
						icon: 'success',
						title: "Success",
						text: data.message,
						allowOutsideClick: false,
						allowEscapeKey: false
					}).then((result) => {
						if (result.isConfirmed) {
							window.location.href = "@Url.Action("List", "WalletCredentialVerification")";
						}
					});

				} else {
					Swal.fire({
						icon: 'error',
						title: "Error",
						text: data.message,
						allowOutsideClick: false,
						allowEscapeKey: false
					}).then((result) => {
						if (result.isConfirmed) {
							window.location.href = "@Url.Action("List", "WalletCredentialVerification")";
						}
					});
				}

			},
			error: ajaxErrorHandler
		});
	});

</script>


