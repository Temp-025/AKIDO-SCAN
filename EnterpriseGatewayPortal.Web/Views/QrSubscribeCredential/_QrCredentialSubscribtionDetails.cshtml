@model EnterpriseGatewayPortal.Web.ViewModel.QrSubscribeCredential.QrSubscribeCredentialViewModel

@{
	ViewData["Title"] = "Wallet Configuration";
}

<style>
    .custom-card {
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        background: #ffffff;
    }

    .custom-fieldset {
        border: none;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }

        .custom-fieldset legend {
            font-size: 1rem;
            font-weight: bold;
            color: #333;
        }

    .nested-fieldset {
        padding-left: 15px;
    }

    .form-check-label {
        font-weight: 500;
    }

    .custom-table th, .custom-table td {
        vertical-align: middle;
    }

    #emailDataTable_wrapper .dataTables_scrollBody,
    #attributeTable_wrapper .dataTables_scrollBody {
        overflow-x: auto;
        scrollbar-width: none; /* For Firefox */
    }

        #emailDataTable_wrapper .dataTables_scrollBody::-webkit-scrollbar,
        #attributeTable_wrapper .dataTables_scrollBody::-webkit-scrollbar {
            display: none; /* For Chrome, Safari, and Edge */
        }

    .card-content {
        overflow-y: auto; /* Add overflow-y to enable vertical scrolling if needed */
        /* max-height: 645px; /* Add max-height to limit the height of the card content */ */
    }

    .table-container {
        width: 100%;
        overflow-x: auto;
    }

    .table-container {
        background-color: white;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 24px;
        /* padding-top: 11px; */
        padding-left: 0px !important;
        padding-right: 37px;
        margin-top: -18px;
        /* padding-bottom: 33px; */
    }

    .container {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 10px;
    }

    .qwer {
        display: flex;
        justify-content: space-between;
        margin-top: 12px;
    }


    .step-label {
        position: absolute;
        bottom: -24px; /* Adjust this value to control the space between the circle and label */
        width: 100px; /* Set the width based on your design */
        text-align: center;
        white-space: nowrap; /* Prevent text from wrapping */
        font-size: 15px;
    }

    .container .steps {
        display: flex;
        width: 76%;
        align-items: center;
        justify-content: space-between;
        position: relative;
        margin: 8px 30px;
        height: 0px;
    }

    .steps .circle {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 35px;
        width: 35px;
        color: #999;
        background: #e0e0e0;
        /* border-radius: 50%; */
        border: 3px solid #e0e0e0;
        z-index: 1;
        transition: all 300ms ease;
        overflow: hidden;
    }

        .steps .circle img {
            height: 56%;
            width: 47%;
        }

        .steps .circle.active {
            border-color: #B68A35;
            color: white;
            background-color: #B68A35;
        }


    .steps .progress-bar {
        position: absolute;
        top: 0%;
        left: 3%;
        transform: translateY(-50%);
        height: 3px;
        width: 94%;
        background: #e0e0e0;
        z-index: 0;
    }

    .progress-bar .indicator {
        position: absolute;
        height: 100%;
        width: 0%;
        background: #B68A35;
        transition: all 300ms ease;
    }

    @@media (max-width: 900px) {
        .App:not(.is-in-desktop-only-mode) .Header, .App:not(.is-in-desktop-only-mode) .Header.Tools {
            height: 0 !important;
            visibility: hidden !important;
        }
    }

    .custom-group {
        display: flex;
        flex-direction: row;
        align-items: center;
        margin-bottom: 15px; /* Adjusts spacing between form groups */
    }

        .custom-group label {
            margin-right: 10px; /* Adjusts spacing between label and input */
            min-width: 120px; /* Set a fixed width for labels to align them vertically */
            text-align: right; /* Aligns the text of the labels */
        }

    .custom-input {
        flex: 1; /* Makes input take the remaining space */
        max-width: 70%; /* Adjusts the width of the input field */
    }

    .classshide {
        display: none !important;
    }

    .content {
        min-height: 84vh;
        transition: all 0.3s;
        height: 592px !important;
    }

    .dataTables_scrollHead {
        background: white;
        top: 0;
        z-index: 10;
    }

    .tree {
        list-style-type: none;
        padding-left: 0;
    }

        .tree label {
            cursor: pointer;
            font-weight: 500;
        }

    .nested {
        display: none;
        padding-left: 20px;
        border-left: 2px solid #B68A35;
    }

    .tree input[type="checkbox"]:checked ~ .nested {
        display: block;
    }

    .formats-container {
        border: 1px solid #ccc; /* Border color */
        border-radius: 10px; /* Rounded corners */
        padding: 19px; /* Space inside the border */
        margin-top: 10px; /* Spacing above the container */
    }

    @@keyframes glow {
        0% {
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }

        50% {
            box-shadow: 0 0 20px rgba(0, 123, 255, 1);
        }

        100% {
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }
    }

    .highlight {
        animation: glow 1s ease-in-out infinite alternate;
    }

    #maincard {
        height: 80vh !important;
        max-height: 100vh;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: transparent transparent;
    }

        /* Hide scrollbar for Webkit browsers (Chrome, Safari, Edge) */
        #maincard::-webkit-scrollbar {
            width: 0px; /* Hide scrollbar */
            background: transparent; /* Transparent background */
        }

        /* Optional: Ensure scrolling still works */
        #maincard::-webkit-scrollbar-thumb {
            background: transparent; /* Fully transparent scrollbar */
        }

    .format-checkbox {
        width: 15px; /* Adjust checkbox size */
        height: 18px; /* Adjust checkbox size */
    }

    .form-check-label {
        font-size: 15px;
        margin-top: 6px; /* Adjust font size */
    }

    .form-check {
        margin-bottom: 10px; /* Space between checkboxes */
        display: flex;
        align-items: center;
        gap: 8px; /* Space between checkbox and label */
    }

    .attributes-card {
        background-color: #ffffff;
        overflow: hidden;
        max-height: 340px;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .attributes-header {
        padding: 12px 16px;
        border-bottom: 1px solid #dee2e6;
        background-color: #f8f9fa;
    }

    .attributes-content {
        display: flex;
        transition: transform 0.4s ease-in-out;
        flex: 1;
        overflow-y: auto;
    }

    .attributes-table {
        width: 50%;
        overflow-y: auto;
    }

    .table th {
        background-color: #f1f1f1;
        font-weight: 600;
    }

    .attributes-footer {
        background-color: #F9F7ED;
        border-top: 1px solid #CCC;
        position: sticky;
        bottom: 0;
    }

    .arrow-icon {
        color: #232528;
        font-size: 14px;
        cursor: pointer;
        user-select: none;
        transition: color 0.3s;
    }

        .arrow-icon:hover {
            color: #B68A35;
        }

    .attributes-table {
        max-height: 300px;
        overflow-y: auto;
        overflow-x: hidden;
    }
        /* Remove background from all body rows and cells */
        .attributes-table tbody tr,
        .attributes-table tbody td {
            background-color: transparent !important;
        }

        /* Optional: Keep table header styled */
        .attributes-table thead th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

    /*-----------------------------------------------------------------*/
    /* Container style */
    .checkbox-primary {
        display: inline-flex !important;
        align-items: center; /* Align vertically center */
        gap: 16px; /* Item spacing = 16px */
        cursor: pointer;
        position: relative;
        color: #232528;
        margin-top: 0.5rem;
        margin-bottom: 13px;
    }

    /* Checkbox itself */
    .custom-check-box {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 20px;
        height: 20px;
        border: 1px solid #CBA344;
        border-radius: 4px;
        background-color: #fff;
        cursor: pointer;
        position: relative;
        z-index: 2;
        transition: background-color 0.2s, border-color 0.2s;
    }

        /* Checkmark style */
        .custom-check-box:checked {
            background-color: #CBA344;
            border-color: #92722A;
        }

            .custom-check-box:checked::after {
                content: "✔";
                color: white;
                font-size: 14px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -55%);
            }

    /* Hover effect (circle background) */
    .checkbox-primary::before {
        content: "";
        position: absolute;
        left: -7px;
        top: -7px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: transparent;
        z-index: 1;
        transition: background-color 0.2s ease-in-out;
    }

    .checkbox-table::before {
        left: -11.5px !important;
        top: -11.5px !important;
    }

    .checkbox-primary:hover::before {
        background-color: #F9F7ED;
    }

    .checkbox-primary input[type="checkbox"]:checked {
        background-color: #CBA344;
        border-color: #CBA344;
    }
    /* Scrollable table body */
    .custom-scroll-table {
        max-height: 350px;
        scrollbar-width: none;
        overflow-y: auto;
    }

        .custom-scroll-table::-webkit-scrollbar {
            display: none;
        }

        /* Make headers sticky */
        .custom-scroll-table thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #fff;
            border-bottom: 2px solid #ddd;
        }

    /* Title row styling */
    .table-title {
        background: #f9f7ed;
        color: #B68A35;
        font-weight: 600;
        font-size: 0.95rem;
        text-align: left;
        border-bottom: 2px solid #ddd;
    }

    /* Table cells */
    .custom-table td,
    .custom-table th {
        padding: 10px 12px;
        vertical-align: middle;
    }

    /* Hover effect */
    .custom-table tbody tr:hover {
        background-color: #fafafa;
    }

    .attributes-content {
        display: flex;
        gap: 20px; /* spacing between tables */
    }

    .attributes-table {
        flex: 1; /* make both equal width */
        min-width: 0; /* prevent flex overflow */
    }

    .table-wrapper {
        max-height: 300px;
        overflow-y: auto;
        scrollbar-width: none;
        border-top: 1px solid #dee2e6;
    }

    .table thead th {
        position: sticky;
        top: 0;
        background: #f8f9fa;
        z-index: 2;
    }

    .table {
        margin-top: 0px !important;
        border-collapse:separate;
        border: none !important;
    }

    .scroll-container {
        scrollbar-width: none;
        -ms-overflow-style: none;
        padding: 0px !important;
    }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        .scroll-container thead th {
            position: sticky;
            top: 0;
            background-color: #f8f9fa;
            z-index: 10;
        }

        .scroll-container td {
            padding-left: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

</style>
<div class="classshide">
	<div id='viewer'></div>
</div>
<div class="row">
	<div class="col-md-12">
		<div class="card shadow-lg" id="maincard">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12 container">
                        <div class="steps">
                            <span class="circle active">
                                <span style="font-size: 15px; font-weight: bold; color:white !important;">1</span>
                            </span>
                            <span class="circle">
                                <span style="font-size: 15px; font-weight: bold;color:white !important;">2</span>
                            </span>
                            <span class="circle">
                                <span style="font-size: 15px; font-weight: bold;color:white !important;">3</span>
                            </span>

                            <div class="progress-bar">
                                <span class="indicator"></span>
                            </div>
                        </div>


                        <div class="qwer">
                            <span class="step-label" style="left: 9%; font-size:13px;">QR Credential Details</span>

                            <span class="step-label" style="left: 46%; font-size:13px;">Select Verifier</span>
                            <span class="step-label" style="left: 82%; font-size:13px;">Send Request</span>
                        </div>
                    </div>


                </div>

                <br />
                <br />

                <div class="row" id="configurationdiv">

                    <div class="col-md-12">
                        <div class="form-group">

                            <div class="col-md-6 form-group plr">

                                <label class="col-form-label s3">Selected QR Credential</label>
                                <input type="text" class="form-control custom-file-input-style2" id="credentialInput" value="@(Model?.CredentialName ?? "N/A")" readonly />

                            </div>
                            <div class="d-flex align-items-center">
                                @* <h5 class="text-primary m-0 mb-1">Attributes</h5> *@

                            </div>
                            <div class="attributes-card position-relative col-md-12 plr">
                                <label class="col-form-label s3">Settings</label>

                                <div class="attributes-content d-flex">
                                    <!-- Public Attributes Table -->
                                    <div class="attributes-table flex-fill me-3">
                                        <div class="scroll-container"
                                             style="max-height: 266px; overflow-y: auto; border: 1px solid #D3D3D3; border-radius:12px;">
                                            <table class="table-striped table-bordered mb-0 table">
                                                <thead>
                                                    <tr>
                                                        <th>Public Attribute</th>
                                                        <th>Display Name</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var item in Model.attributes.publicAttributes)
                                                    {
                                                        <tr>
                                                            <td>@item.attribute</td>
                                                            <td>@item.displayName</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Private Attributes Table -->
                                    <div class="attributes-table flex-fill">
                                        <div class="scroll-container"
                                             style="max-height: 266px; overflow-y: auto; border: 1px solid #D3D3D3; border-radius:12px;">
                                            <table class="table-striped table-bordered mb-0 table">
                                                <thead>
                                                    <tr>
                                                        <th>Private Attribute</th>
                                                        <th>Display Name</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var item in Model.attributes.privateAttributes)
                                                    {
                                                        <tr>
                                                            <td>@item.attribute</td>
                                                            <td>@item.displayName</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div>




                        </div>
                    </div>
                </div>

                <div class="row classshide" id="emailDiv">
                    <!-- Left Side: Verifier Emails -->
                    <div class="col-md-7">
                        <div class="card shadow-lg" style="border-radius: 12px; overflow: hidden;padding:0px !important;">
                            <div class="table-responsive custom-scroll-table" style="padding: 0px;">
                                <table id="emailDataTable" class="table-striped custom-table mb-0 table" style="margin-top:0px !important;">
                                    <thead style="z-index:10;position:sticky;">
                                        <tr>
                                            <th colspan="2" class="table-title">Verifier Emails</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var email in Model.BulkSignerEmails.bulkSignerList.Distinct())
                                        {
                                            <tr>
                                                <td>@email</td>
                                                <td class="text-center">
                                                    <label class="checkbox-primary checkbox-table">
                                                        <input type="checkbox"
                                                               class="custom-check-box select-checkbox VerifierEmails"
                                                               data-email="@email">
                                                    </label>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side: Selected Emails -->
                    <div class="col-md-5">
                        <div class="card shadow-lg" style="border-radius: 12px; overflow: hidden;padding:0px;">
                            <div class="table-responsive custom-scroll-table">
                                <table class="table-striped custom-table mb-0 table" style="margin-top:0px !important;">
                                    <thead>
                                        <tr>
                                            <th class="table-title">Selected Verifier Emails</th>
                                        </tr>
                                    </thead>
                                    <tbody id="selectedEmails">
                                        <tr>
                                            <td class="text-muted">No Verifier Emails selected</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>


                <div style="padding-right: 10px;">
                    <div style="float: right;">

                        <div id="configuration">
                            <button type="button" variant="outlined" id="backButton1" class="btn btn-other classshide" style="margin-left:18px; float:right">Back</button>
                            @* <button type="button" variant="outlined" onclick="ViewConfigurationDetails()" class="btn btn-primary greenButton" id="view-config-btn" style="margin-left:18px; float:left; margin-top: 114px;">View Configuration Details</button>
                            *@
                            <button type="button" variant="outlined" id="nextButton" class="btn btn-primary uaeid-primary greenButton" style="height: 36px; font-size: 13px;margin-bottom:20px;margin-top:20px;">
                                Next
                            </button>

                        </div>
                        @* <div class="classshide" id="Attributes">
                    <button type="button" id="backButton2" class="btn btn-danger uaeid-secondary" style="margin-left:18px; float:left;height: 36px;width: 79px; font-size: 13px;">Back</button>

                    <button type="button" variant="outlined" id="Continue" class="btn btn-primary uaeid-primary greenButton" style="margin-left:18px; float:right;height: 36px;width: 79px; font-size: 13px;">Next</button>

                </div> *@
                        <div class="classshide" id="VerifierEmail" style="margin-bottom: 20px;">

                            <button type="button" id="backbutton" class="btn btn-other" style="margin-left:18px; float:left;height: 36px; font-size: 13px;">Back</button>
                            &nbsp;&nbsp;
                            <button class="btn btn-primary uaeid-primary greenButton SubscribeCredential" type="button" style="height: 36px;width: 183px; font-size: 13px;">Subscribe Credential</button>

                        </div>
                    </div>

                </div>

            </div>

		</div>
	</div>

</div>





<script>
	$(document).ready(function () {
		var QrLink = document.getElementById('QrServiceModle').querySelector('.nav-link');
		QrLink.click();

		$('#QrSubscribeCredentialsMenu').addClass('active');

		$('#networkOverlay').hide();
        document.getElementById("navigationNetworkOverlay").style.display = "none";

	});

	const slider = document.getElementById("tablesSlider");
	const leftArrow = document.getElementById("leftArrow");
	const rightArrow = document.getElementById("rightArrow");

	// Initially hide the left arrow (Previous)
	//leftArrow.style.display = "none";

	//leftArrow.addEventListener("click", function () {
	//	slider.style.transform = "translateX(0%)";
	//	leftArrow.style.display = "none";       // Hide Previous
	//	rightArrow.style.display = "inline";    // Show Next
	//});

	//rightArrow.addEventListener("click", function () {
	//	slider.style.transform = "translateX(-50%)";
	//	rightArrow.style.display = "none";      // Hide Next
	//	leftArrow.style.display = "inline";     // Show Previous
	//});

	// const slider = document.getElementById("tablesSlider");
	// const leftArrow = document.getElementById("leftArrow");
	// const rightArrow = document.getElementById("rightArrow");

	// // Initial state: showing public (first) table
	// let currentSlide = 0;

	// // Function to update slider and button states
	// function updateSlider() {
	// 	slider.style.transform = currentSlide === 0 ? "translateX(0%)" : "translateX(-50%)";
	// 	leftArrow.classList.toggle("disabled", currentSlide === 0);
	// 	rightArrow.classList.toggle("disabled", currentSlide === 1);
	// }

	// leftArrow.addEventListener("click", function () {
	// 	if (currentSlide > 0) {
	// 		currentSlide--;
	// 		updateSlider();
	// 	}
	// });

	// rightArrow.addEventListener("click", function () {
	// 	if (currentSlide < 1) {
	// 		currentSlide++;
	// 		updateSlider();
	// 	}
	// });

	// // Initialize on load
	// updateSlider();


	var credentialId = "@(Model?.credentialId ?? "null")";
	var organizationId = "@(Model?.organizationId ?? "null")";
	var attributes = @Html.Raw(Json.Serialize(Model.attributes));
	var steps = document.querySelectorAll('.steps .circle');
	var line = document.querySelector('.progress-bar .indicator');
	// Convert "null" string to actual null in JavaScript if needed
	credentialId = credentialId === "null" ? null : credentialId;
	organizationId = organizationId === "null" ? null : organizationId;


	document.querySelectorAll('.format-checkbox').forEach(checkbox => {
		checkbox.addEventListener('change', function () {
			const settingsIcon = document.getElementById('settings-icon');
			const viewConfigBtn = document.getElementById('view-config-btn');
			if (document.querySelectorAll('.format-checkbox:checked').length > 0) {
				settingsIcon.classList.add('highlight');
				viewConfigBtn.classList.add('highlight');
			} else {
				settingsIcon.classList.remove('highlight');
				viewConfigBtn.classList.remove('highlight');
			}
		});
	});


	const checkboxes = document.querySelectorAll(".attribute");
	const selectedAttributesList = document.getElementById("selectedAttributes");

	checkboxes.forEach(checkbox => {
		checkbox.addEventListener("change", updateSelectedAttributes);
	});

	function updateSelectedAttributes() {
		const selectedAttributes = Array.from(checkboxes)
			.filter(cb => cb.checked)
			.map(cb => cb.getAttribute("data-attribute"));

		selectedAttributesList.innerHTML = selectedAttributes.length > 0
			? selectedAttributes.map(attr => `<li class="list-group-item">${attr}</li>`).join('')
			: '<li class="list-group-item text-muted">No attributes selected</li>';
	}

	const verifyerEmail = document.querySelectorAll(".VerifierEmails");
	const selectedEmailList = document.getElementById("selectedEmails");

	verifyerEmail.forEach(checkbox => {
		checkbox.addEventListener("change", function () {
			updateSelectedEmails();
		});
	});

	function updateSelectedEmails() {
		const selectedAttributes = Array.from(verifyerEmail)
			.filter(cb => cb.checked)
			.map(cb => cb.getAttribute("data-email"));

		selectedEmailList.innerHTML = selectedAttributes.length > 0
			? selectedAttributes.map(attr => `<li class="list-group-item">${attr}</li>`).join('')
			: '<li class="list-group-item text-muted">No Verifier Emails selected</li>';
	}

	var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
	var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
		return new bootstrap.Tooltip(tooltipTriggerEl);
	});


	function updateProgressBar(step, color) {
		steps.forEach((stepElement, index) => {
			stepElement.classList[index < step ? 'add' : 'remove']('active');
		});

		var width = ((step - 1) / (steps.length - 1)) * 100;
		line.style.width = width + '%';
		line.style.background = color;
	}

	function updateCircleColors(step, color) {
		steps.forEach((stepElement, index) => {
			stepElement.style.borderColor = index < step ? color : '#e0e0e0';
			stepElement.style.color = index < step ? color : '#e0e0e0';
		});
	}

	$("#nextButton").on("click", function (e) {
		e.preventDefault(); // Prevent default action

		// Scroll smoothly to the top first, then update the progress bar
		$('#maincard').animate({ scrollTop: 0 }, 300, function () {
			// Once scrolling completes, update UI elements

			$('#configurationdiv').addClass("classshide");
			$('#configuration').addClass("classshide");
			$('#emailDiv').removeClass("classshide");
			$('#VerifierEmail').removeClass("classshide");
			updateProgressBar(2, "#B68A35");
			updateCircleColors(2, "#B68A35");
		});
	});



	// $("#Continue").on("click", function (e) {
	// 	e.preventDefault(); // Prevent default action (if any)

	// 	$('#maincard').animate({ scrollTop: 0 }, 300, function () {
	// 		$('#DataAttivutesDiv').addClass("classshide");
	// 		$('#Attributes').addClass("classshide");
	// 		$('#configurationdiv').addClass("classshide");
	// 		$('#configuration').addClass("classshide");
	// 		$('#emailDiv').removeClass("classshide");
	// 		$('#VerifierEmail').removeClass("classshide");
	// 		updateProgressBar(3, "#B68A35");
	// 		updateCircleColors(3, "#B68A35");
	// 	});
	// });

	// $("#backButton2").on("click", function (e) {
	// 	e.preventDefault(); // Prevent default action (if any)

	// 	$('#maincard').animate({ scrollTop: 0 }, 300, function () {
	// 		$('#DataAttivutesDiv').addClass("classshide");
	// 		$('#Attributes').addClass("classshide");
	// 		$('#configurationdiv').removeClass("classshide");
	// 		$('#configuration').removeClass("classshide");
	// 		$('#emailDiv').addClass("classshide");
	// 		$('#VerifierEmail').addClass("classshide");
	// 		updateProgressBar(1, "#B68A35");
	// 		updateCircleColors(1, "#B68A35");
	// 	});
	// });

	$("#backbutton").on("click", function (e) {
		e.preventDefault(); // Prevent default action (if any)

		$('#maincard').animate({ scrollTop: 0 }, 300, function () {

			$('#configurationdiv').removeClass("classshide");
			$('#configuration').removeClass("classshide");
			$('#emailDiv').addClass("classshide");
			$('#VerifierEmail').addClass("classshide");
			updateProgressBar(1, "#B68A35");
			updateCircleColors(1, "#B68A35");
		});
	});

	function ViewCredentialDetails() {

		var dataToSend = { CredentialUId: credentialId };
		$.ajax({
			url: '@Url.Action("ViewCredentialDetails", "WalletCredentialVerification")',
			data: dataToSend,
			type: "GET",
			/*contentType: "json",*/
			error: ajaxErrorHandler,
			beforeSend: function () {
				$('#overlay').show();
			},
			complete: function () {
				$('#overlay').hide();
			},
			success: function (data) {
				if (data != null) {
					$('#modalDialogContentDiv').html(data);
					$('#modalDialogDiv').modal('show');
				}
				else {
					Swal.fire({ icon: 'error', title: "Error", text: "Failed to get payment info" });
				}
			},
			error: ajaxErrorHandler

		});
	}

	function ViewConfigurationDetails() {

		var dataToSend = { CredentialUId: credentialId };
		$.ajax({
			url: '@Url.Action("ViewWalletConfigurationDetails", "Wallet")',
			data: dataToSend,
			type: "GET",
			/*contentType: "json",*/
			error: ajaxErrorHandler,
			beforeSend: function () {
				$('#overlay').show();
			},
			complete: function () {
				$('#overlay').hide();
			},
			success: function (data) {
				if (data != null) {
					$('#modalDialogContentDiv').html(data);
					$('#modalDialogDiv').modal('show');
				}
				else {
					Swal.fire({ icon: 'error', title: "Error", text: "Failed to get payment info" });
				}
			},
			error: ajaxErrorHandler

		});
	}
	// Function to collect selected checkboxes and send data to controller
	$(".SubscribeCredential").on("click", function () {
		var selectedAttributes = [];
		var selectedEmails = [];
		var selectedConfigurations = [];



		// Collect selected emails
		$(".select-checkbox[data-email]:checked").each(function () {
			selectedEmails.push($(this).data("email"));
		});
		if (selectedEmails.length === 0) {

			Swal.fire({ icon: 'error', title: "Validation Error", text: "Please select at least one email before proceeding." });
			return; // Stop the process
		}





		// Construct JSON object
		var verifyCredential = {
			credentialId: credentialId, // Placeholder (Ensure it's properly assigned)
			organizationId: organizationId, // Placeholder (Ensure it's properly assigned)
			attributes: attributes,

			emails: selectedEmails,
		};

		// AJAX Call to Controller
		$.ajax({
			url: '@Url.Action("AddQRCredentialVerificationRquest", "QrSubscribeCredential")',
			type: 'POST',
			contentType: 'application/json',
			data: JSON.stringify(verifyCredential),
			beforeSend: function () {
				$('#overlay').show();
			},
			complete: function () {
				$('#overlay').hide();
			},
			success: function (data) {
				if (data.success) {
					$('#configurationdiv, #configuration').addClass("classshide");
					$('#emailDiv, #VerifierEmail').removeClass("classshide");
					updateProgressBar(3, "#B68A35");
					updateCircleColors(3, "#B68A35");

					window.scrollTo(0, 0);
					Swal.fire({
						icon: 'success',
						title: "Success",
						text: data.message,
						showCancelButton: false,
						confirmButtonText: "OK"
					}).then((result) => {
						if (result.isConfirmed) {
							window.location.href = "@Url.Action("List", "QrSubscribeCredential")";
						}
					});
				} else {
					Swal.fire({
						icon: 'error',
						title: "Error",
						text: data.message,
						showCancelButton: false,
						confirmButtonText: "OK"
					}).then((result) => {
						if (result.isConfirmed) {
							window.location.href = "@Url.Action("List", "QrSubscribeCredential")";
						}
					});
				}

			},
			error: ajaxErrorHandler
		});
	});

</script>


